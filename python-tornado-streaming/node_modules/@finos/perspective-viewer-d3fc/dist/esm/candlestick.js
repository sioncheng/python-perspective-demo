var Oa=Object.defineProperty;var lt=(e,t)=>{for(var n in t)Oa(e,n,{get:t[n],enumerable:!0})};Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector);Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector);Element.prototype.closest||(Element.prototype.closest=function(e){var t=this;do{if(t.matches(e))return t;t=t.parentElement||t.parentNode}while(t!==null&&t.nodeType===1);return null});import*as sr from"d3fc";import*as he from"d3fc";var C={none:"none",ordinal:"ordinal",time:"time",linear:"linear"},Ee=e=>{let t="crossValues",n=null,r=null,a=()=>{let o=i=>{let l=n?e[t].filter(s=>n==s.name):e[t];return t=="crossValues"&&l.length>1?!1:l.some(s=>i.includes(s.type))};return e[t].length===0?C.none:r!=C.time&&o(["datetime","date"])?C.time:r!=C.linear&&o(["integer","float"])||r==C.ordinal?C.linear:C.ordinal};return a.settingName=(...o)=>o.length?(t=o[0],a):t,a.settingValue=(...o)=>o.length?(n=o[0],a):n,a.excludeType=(...o)=>o.length?(r=o[0],a):r,a};var $t={};lt($t,{domain:()=>Ra,labelFunction:()=>It,scale:()=>Fa});import*as wn from"d3";var bn=e=>{let t=n=>(r,a)=>r===void 0?a:a===void 0?r:n(r,a);return e.reduce((n,r)=>[t(Math.min)(n[0],r[0]),t(Math.max)(n[1],r[1])],[void 0,void 0])},me=e=>Array.isArray(e)?e.flat(1/0):[e];import{rebindAll as za}from"d3fc";var Pa=1,st=e=>{let t=n=>e(n);return za(t,e),t.bandwidth=(...n)=>n.length?(e.bandwidth(...n),t):Math.max(e.bandwidth(),Pa),t};import{rebindAll as Ea}from"d3fc";var vn=e=>{let t=n=>e(n);return Ea(t,e),t.ticks=function(){return[]},t};var Fa=()=>vn(st(wn.scaleBand())),Ra=()=>{let e=["crossValue"],t="horizontal",n=a=>{let o=me(a);return r([...new Set(o.map(i=>i[e[0]]))])},r=a=>t=="vertical"?a.reverse():a;return n.valueName=(...a)=>a.length?(e=[a[0]],n):e[0],n.valueNames=(...a)=>a.length?(e=a[0],n):e,n.orient=(...a)=>a.length?(t=a[0],n):t,n},It=e=>t=>t[e].join("|");var pt={};lt(pt,{component:()=>Ia,domain:()=>jt,labelFunction:()=>Wt,scale:()=>Ba,tickFormatFunction:()=>Yt});import*as Xe from"d3";import*as ee from"d3fc";import*as pe from"d3-array";var ct=()=>{let e=[0,0],t="percent",n=r=>{switch(t){case"domain":{r[0]-=e[0],r[1]+=e[1];break}case"percent":{let a=r[1]-r[0];r[0]-=e[0]*a,r[1]+=e[1]*a;break}default:throw new Error("Unknown padUnit: "+t)}return r};return n.pad=function(...r){return r.length?(e=r[0],n):e},n.padUnit=function(...r){return r.length?(t=r[0],n):t},n};var Vn=function(){let e=[function(o){return o}],t=null,n=[],r=ct(),a=function(i){let l=new Array(i.length),s=!0,c=!1,u,d=e[Symbol.iterator]();try{for(let p;!(s=(p=d.next()).done);s=!0){let f=p.value;for(let h=0;h<i.length;h++){let y=f(i[h],h);Array.isArray(y)?l.push.apply(l,Gt(y)):l.push(y)}}}catch(p){c=!0,u=p}finally{try{!s&&d.return&&d.return()}finally{if(c)throw u}}let m=[pe.min(l),pe.max(l)];if(m[0]=m[0]==null?pe.min(n):pe.min([m[0]].concat(Gt(n))),m[1]=m[1]==null?pe.max(n):pe.max([m[1]].concat(Gt(n))),t!=null){let p=Math.max(Math.abs(m[1]-t),Math.abs(m[0]-t));m[0]=t-p,m[1]=t+p}return r(m)};return a.accessors=function(){return arguments.length?(e=arguments.length<=0?void 0:arguments[0],a):e},a.pad=function(...o){return o.length?(r.pad(o[0]),a):r.pad},a.padUnit=function(...o){return o.length?(r.padUnit(o[0]),a):r.padUnit},a.include=function(...o){return o.length?(n=o[0],a):n},a.symmetricalAbout=function(...o){return o.length?(t=o[0],a):t},a.paddingStrategy=function(...o){return o.length?(r=o[0],a):r},a},Gt=function(e){if(Array.isArray(e)){let t=Array(e.length);for(let n=0;n<e.length;n++)t[n]=e[n];return t}else return Array.from(e)};import*as ut from"d3";var Ha=1e7,mt=(e,t)=>{let n=Math.ceil(Math.abs(Math.log10(t-e)))+1;return r=>Math.abs(r)>=Ha?ut.format(".3s")(r):Number.isInteger(r)?ut.format(",.0f")(r):ut.format(`,.${n}f`)(r)};function Fe(e){return e.getRootNode().host}function de(e){return e.closest("#container.chart")}var Ba=()=>Xe.scaleLinear(),jt=()=>{let e=Vn().pad([0,.1]).padUnit("percent"),t=["crossValue"],n=o=>(e.accessors(t.map(i=>l=>parseFloat(l[i]))),a(me(o)));ee.rebindAll(n,e);let r=o=>{let i=t.map(l=>o.map(s=>s[l]).sort((s,c)=>s-c).filter((s,c,u)=>c===0||s!==u[c-1]).reduce((s,c,u,d)=>u===0||s<=c-d[u-1]?s:Math.abs(c-d[u-1])));return Math.min(...i)},a=o=>{if(e.padUnit()=="domain"){let i=r(o);return e.pad([i/2,i/2])(o)}else return e(o)};return n.valueName=(...o)=>o.length?(t=[o[0]],n):t[0],n.valueNames=(...o)=>o.length?(t=o[0],n):t,n},Wt=e=>t=>t[e][0],Yt=mt,Ia=e=>{let t=null,n="horizontal",r=null,a=(c,u)=>{try{return de(c.node()).querySelector(".cartesian-chart").querySelector(`.${u}-axis`)}catch{return null}},o=c=>{let u=Xe.select(c).select("text").node();u.style.fontSize="80%"},i=(c,u)=>{let d=c.getBoundingClientRect();u.each((m,p,f)=>{let h=Xe.select(f[p]).node().getBoundingClientRect();(n=="vertical"&&d.width<h.width||n=="horizontal"&&d.height<h.height)&&o(f[p])})},l=(c,u,d)=>{let m=a(c,u);m&&i(m,c)},s=()=>({bottom:ee.axisBottom,left:ee.axisLeft,top:ee.axisTop,right:ee.axisRight,decorate:l});return s.domain=(...c)=>c.length?(t=c[0],s):t,s.orient=(...c)=>c.length?(n=c[0],s):n,s.settingName=(...c)=>c.length?(r=c[0],s):r,s};var Kt={};lt(Kt,{domain:()=>Ga,labelFunction:()=>Ut,scale:()=>$a});import*as _n from"d3";import*as Re from"d3fc";var $a=()=>_n.scaleTime(),Ga=()=>{let e=Re.extentTime(),t=["crossValue"],n=o=>(e.accessors(t.map(i=>l=>new Date(l[i]))),a(me(o)));Re.rebindAll(n,e,Re.exclude("include","paddingStrategy"));let r=o=>{let i=t.map(l=>o.map(s=>new Date(s[l]).getTime()).sort((s,c)=>s-c).filter((s,c,u)=>c===0||s!==u[c-1]).reduce((s,c,u,d)=>u===0||Math.abs(s)<=Math.abs(c-d[u-1])?Math.abs(s):Math.abs(c-d[u-1])));return Math.min(...i)},a=o=>{let i=Math.abs(r(o));return e.padUnit("domain").pad([i/2,i/2])(o)};return n.valueName=(...o)=>o.length?(t=[o[0]],n):t[0],n.valueNames=(...o)=>o.length?(t=o[0],n):t,n},Ut=e=>t=>new Date(t[e][0]);var qt={};lt(qt,{component:()=>Ja,domain:()=>Za,labelFunction:()=>Xt,scale:()=>qa});import*as qe from"d3";import*as fe from"d3fc";import{select as An,line as ja}from"d3";import{axisOrdinalTop as Wa,axisOrdinalBottom as Ya,axisOrdinalLeft as Ua,axisOrdinalRight as Ka,dataJoin as Tn,rebindAll as Dn,exclude as Xa}from"d3fc";var Cn=(...e)=>{let t={},n=r=>{for(let a of Object.keys(t))r[a](t[a]);return r};for(let r of e)n[r]=(...a)=>a.length?(t[r]=a[0],n):t[r];return n};var dt=(e,t,n)=>{let r=6,a=6,o=Cn("tickFormat","ticks","tickArguments","tickValues","tickPadding"),i=(...h)=>{},l=null,s=Tn("g","group"),c=Tn("path","domain"),u=(h,y)=>m()?`translate(${y}, ${h})`:`translate(${h}, ${y})`,d=h=>m()?h.map(y=>[y[1],y[0]]):h,m=()=>e==="left"||e==="right",p=h=>{if(!l){o(t(n).decorate(i))(h);return}h.each((y,g,x)=>{let b=x[g],S=An(b),v=e==="bottom"||e==="right"?1:-1,V=n.range(),D=d([[V[0],v*r],[V[0],0],[V[1],0],[V[1],v*r]]);c(S,[y]).attr("d",ja()(D)).attr("stroke","#000").attr("fill","none");let j=s(S,l),k=$=>Array.isArray(a)?a[$]:a,N=$=>{let M=0;for(let F=0;F<$;F++)M+=k(F);return M};j.attr("transform",($,M)=>u(0,v*N(M))).each(($,M,F)=>{let J=An(F[M]),X=f(n,$);o(t(X)).decorate((q,Q)=>i(q,Q,M)).tickSizeInner(k(M)).tickOffset(q=>X.step(q)/2)(J),J.select("path.domain").attr("visibility","hidden")}),j.exit().attr("transform",($,M)=>u(0,v*N(M)))})},f=(h,y)=>{function g(x){let b=x.domain;return b.reduce((S,v)=>S+h(v),0)/b.length}return g.ticks=()=>y,g.tickFormat=()=>x=>x.text,g.copy=()=>f(h,y),g.step=x=>x.domain.length*h.step(),Dn(g,h,Xa("ticks","step","copy")),g};return p.tickSize=(...h)=>h.length?(a=r=Number(h[0]),p):a,p.tickSizeInner=(...h)=>h.length?(a=Array.isArray(h[0])?h[0]:Number(h[0]),p):a,p.tickSizeOuter=(...h)=>h.length?(r=Number(h[0]),p):r,p.decorate=(...h)=>h.length?(i=h[0],p):i,p.groups=(...h)=>h.length?(l=h[0],p):l,Dn(p,o),p},Ln=e=>dt("top",Wa,e),kn=e=>dt("bottom",Ya,e),Nn=e=>dt("left",Ua,e),Mn=e=>dt("right",Ka,e);var qa=()=>st(qe.scaleBand()).padding(.5),Za=()=>{let e=["crossValue"],t="horizontal",n=a=>{let o=me(a);return r([...Array.from(new Set(o.map(i=>i[e[0]])))])},r=a=>t=="vertical"?a.reverse():a;return n.valueName=(...a)=>a.length?(e=[a[0]],n):e[0],n.valueNames=(...a)=>a.length?(e=a[0],n):e,n.orient=(...a)=>a.length?(t=a[0],n):t,n},Xt=e=>t=>t[e].join("|"),Ja=e=>{let t="horizontal",n="crossValues",r=null,a=()=>{let m=e[n].length>1,p=i(r),f=p.map(l),h=m?f.map(S=>S.size):f[0].size,y=f.reduce((S,v)=>S+v.size,0),g=S=>v=>{let V=S(v);return m&&V.groups(p).tickSizeInner(h).tickSizeOuter(y),t!=="horizontal"&&V.tickPadding(10),V},x=(S,v,V)=>{let D=f[V].rotation;t==="horizontal"&&d(S,D),s(S,D)},b=o(m);return{bottom:g(b.bottom),left:g(b.left),right:g(b.right),top:g(b.top),size:`${y+10}px`,decorate:x}},o=m=>m?{bottom:kn,left:Nn,top:Ln,right:Mn}:{bottom:fe.axisOrdinalBottom,left:fe.axisOrdinalLeft,top:fe.axisOrdinalTop,right:fe.axisOrdinalRight},i=m=>{let p=[];return m.forEach(f=>{(f&&f.split?f.split("|"):[f]).forEach((y,g)=>{for(;p.length<=g;)p.push([]);let x=p[g];x.length>0&&x[x.length-1].text===y?x[x.length-1].domain.push(f):x.push({text:y,domain:[f]})})}),p.reverse()},l=m=>{let p=e.size.width,f=Math.max(...m.map(h=>h.text?h.text.length:0));return t==="horizontal"?m&&m.length*16>p-100?{size:f*5+10,rotation:90}:m&&m.length*(f*6+10)>p-100?{size:f*3+20,rotation:45}:{size:25,rotation:0}:{size:f*5+10,rotation:0}},s=(m,p)=>{let f=v=>{let V=v.indexOf(",")!==-1?",":" ",D=v.substring(v.indexOf("(")+1,v.indexOf(")")).split(V).map(I=>parseInt(I));for(;D.length<2;)D.push(0);return D},g=p?(v,V)=>v.x+v.width+14>V.x+V.width:(v,V)=>v.x<=V.x+V.width&&V.x<=v.x+v.width&&v.y<=V.y+V.height&&V.y<=v.y+v.height,x=(v,V)=>v.x>=V.x&&v.x+v.width<=V.x+V.width&&v.y>=V.y&&v.y+v.height<=V.y+V.height,b=t=="horizontal"?c(m):null,S=[];m.each((v,V,D)=>{let I=qe.select(D[V]),j=f(I.attr("transform")),k=I.node().getBBox(),N={x:k.x+j[0],y:k.y+j[1],width:k.width,height:k.height},M=S.some(F=>g(F,N))||b&&!x(N,b);I.attr("visibility",M?"hidden":""),M||S.push(N)})},c=m=>{let p=de(m.node());if(p===null)return;let f=p.querySelector(".cartesian-chart"),h=f.querySelector(".x-axis"),y=f.getBoundingClientRect(),g=h.getBoundingClientRect();return{x:y.left-g.left,width:y.width,y:y.top-g.top,height:y.height}},u=m=>m?m<60?`rotate(-${m} 5 5)`:`rotate(-${m} 3 7)`:"translate(0, 8)",d=(m,p)=>{let f=u(p),h=p?"end":"";m.each((y,g,x)=>{qe.select(x[g]).select("text").attr("transform",f).style("text-anchor",h)})};return a.orient=(...m)=>m.length?(t=m[0],a):t,a.settingName=(...m)=>m.length?(n=m[0],a):n,a.domain=(...m)=>m.length?(r=m[0],a):r,a};var Qa={none:$t,ordinal:qt,time:Kt,linear:pt},A=e=>{let t=null,n="horizontal",r="crossValues",a,o=["crossValue"],i=null,l=null,s=["include","paddingStrategy","pad"],c={},u=p=>{let f=Ee(e).excludeType(t).settingName(r).settingValue(a)(),h=Qa[f],y=h.domain().valueNames(o);s.forEach(S=>{c[S]&&y[S]&&y[S](c[S])}),y.orient&&y.orient(n);let g=y(p);i!==null&&(g=i(g)),l&&typeof g[0]=="number"&&(l[0]=g[0]=Math.min(g[0],l[0]),l[1]=g[1]=Math.max(g[1],l[1]));let x=h.hasOwnProperty("component")?d(h,g,p):m(),b=h==pt?Yt(g[0],g[1]):void 0;return{scale:h.scale(),domain:g,domainFunction:y,labelFunction:h.labelFunction,component:{bottom:x.bottom,left:x.left,top:x.top,right:x.right},size:x.size,decorate:x.decorate,label:e[r].map(S=>S.name).join(", "),tickFormatFunction:b}},d=(p,f,h)=>p.component(e).orient(n).settingName(r).domain(f)(h),m=()=>({bottom:he.axisBottom,left:he.axisLeft,top:he.axisTop,right:he.axisRight,decorate:()=>{}});return u.memoValue=(...p)=>p.length?(l=p[0],u):l,u.excludeType=(...p)=>p.length?(t=p[0],u):t,u.orient=(...p)=>p.length?(n=p[0],u):n,u.settingName=(...p)=>p.length?(r=p[0],u):r,u.settingValue=(...p)=>p.length?(a=p[0],u):a,u.valueName=(...p)=>p.length?(o=[p[0]],u):o[0],u.valueNames=(...p)=>p.length?(o=p[0],u):o,u.modifyDomain=p=>p?(i=p,u):i,s.forEach(p=>{u[p]=(...f)=>f.length?(c[p]=f[0],u):c[p]}),u};import*as ge from"d3";import*as Ae from"d3fc";var Y=(e,t)=>On(e,t,(n,r)=>n.svgPlotArea(r),!1),He=(e,t)=>On(e,t,(n,r)=>n.canvasPlotArea(r).svgPlotArea(Ae.seriesSvgPoint()),!0),On=(e,t,n,r)=>{let a=null,o=null,i=Ae.chartCartesian({xScale:e.scale,yScale:t.scale,xAxis:e.component,yAxis:t.component}).xDomain(e.domain).xLabel(e.label).xAxisHeight(e.size).xDecorate(e.decorate).xTickFormat(e.tickFormatFunction).yDomain(t.domain).yLabel(t.label).yAxisWidth(t.size).yDecorate(t.decorate).yOrient("left").yTickFormat(t.tickFormatFunction);e.decorate&&i.xDecorate(e.decorate),t.decorate&&i.yDecorate(t.decorate),i.xPaddingInner&&i.xPaddingInner(1),i.xPaddingOuter&&i.xPaddingOuter(.5),i.yPaddingInner&&i.yPaddingInner(1),i.yPaddingOuter&&i.yPaddingOuter(.5),i.axisSplitter=(...s)=>s.length?(a=s[0],i):a,i.altAxis=(...s)=>s.length?(o=s[0],i):o,i.plotArea=function(...s){return s.length==0?r?this.canvasPlotArea():this.svgPlotArea():n(this,...s)};let l=i.decorate();return i.decorate((s,c)=>{let u=s.select("d3fc-svg.plot-area"),d=u.select("svg").node();d.setAttribute("viewBox",`0 0 ${u.node().clientWidth} ${u.node().clientHeight}`),d.setAttribute("preserveAspectRatio","none");for(let m of["x-axis","y-axis"])s.select(`d3fc-svg.${m} svg`).node().setAttribute("preserveAspectRatio","none");if(l(s,c),r){let m=s.select(".svg-plot-area").node(),p=s.select(".canvas-plot-area").node();ge.selectAll([m,p]).order()}if(!!a){if(a.haveSplit()){let m=a.altData(),p=Ae.dataJoin("d3fc-svg","y2-axis").key(g=>g),f=Ae.dataJoin("g","y-series").key(g=>g);s.append("div").attr("class","y-label right-label").style("grid-column",5).style("-ms-grid-column",5).style("grid-row",3).style("-ms-grid-row",3).style("width",o.size||"1em").style("display","flex").style("align-items","center").style("justify-content","center").append("span").attr("class","y-label splitter-label").style("transform","rotate(-90deg)");let h=o.scale.domain(o.domain),y=o.component.right(h);if(y.tickFormat(o.tickFormatFunction),o.decorate&&y.decorate(o.decorate),p(s,["right"]).attr("class",g=>`y-axis ${g}-axis`).on("measure",function(g,x){let{width:b,height:S}=g.detail;x==="left"&&ge.select(g.currentTarget).select("svg").attr("viewBox",`${-b} 0 ${b} ${S}`).attr("preserveAspectRatio","none"),h.range([S,0])}).on("draw",function(g,x){ge.select(g.currentTarget).select("svg").call(y)}),r){let g=x=>{let b=i.plotArea();b.context(x.node().getContext("2d")).xScale(e.scale);let S=[t.scale,h];[c,m].forEach((v,V)=>{b.yScale(S[V]),b(v)})};s.select("d3fc-canvas.plot-area").on("draw",function(x,b){g(ge.select(x.currentTarget).select("canvas"))})}else{let g=function(x){let b=i.plotArea();b.xScale(e.scale);let S=[t.scale,h];f(x,[c,m]).each((v,V,D)=>{b.yScale(S[V]),ge.select(D[V]).datum(v).call(b)})};s.select("d3fc-svg.plot-area").on("draw",function(x,b){g(ge.select(x.currentTarget).select("svg"))})}}a(s)}}),i};import*as ce from"d3fc";import{select as en}from"d3";function O(e,t,n){let r=e.select(t);return r.size()>0?r:n()}function te(e,t,n="right"){if(n==="right"||n==="bottom")return e[n]<t[n];if(n==="left"||n==="top")return e[n]>t[n];throw`Direction being checked for overflow is invalid: ${n}`}function Zt(e,t,n,r=0){let a=e==="x"?"width":"height",o=t[e],i=t[e]+t[a],l=n[e],s=n[e]+n[a],c=l+r>o&&l-r<i,u=s+r>o&&s-r<i,d=l+r<o&&s-r>i;return c||u||d}var zn=`<ul id="tooltip-values"></ul>
`;import{select as to}from"d3";var Pn={types:{float:{filter_operator:"==",aggregate:"sum",format:{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2}},string:{filter_operator:"==",aggregate:"count"},integer:{filter_operator:"==",aggregate:"sum",format:{}},boolean:{filter_operator:"==",aggregate:"count"},datetime:{filter_operator:"==",aggregate:"count",format:{dateStyle:"short",timeStyle:"medium"},null_value:-1},date:{filter_operator:"==",aggregate:"count",format:{dateStyle:"short"},null_value:-1}}};function Be(e){let t={};if(En().types[e]&&Object.assign(t,En().types[e]),t.type){let n=Be(t.type);return Object.assign(n,t),n}else return t}function Jt(e){return e&&typeof e=="object"&&!Array.isArray(e)}function Qt(e,...t){if(!t.length)return e;let n=t.shift();if(Jt(e)&&Jt(n))for(let r in n)Jt(n[r])?(e[r]||Object.assign(e,{[r]:{}}),Qt(e[r],n[r])):Object.assign(e,{[r]:n[r]});return Qt(e,...t)}function En(){return globalThis.__PERSPECTIVE_CONFIG__||(globalThis.__PERSPECTIVE_CONFIG__=Qt(Pn,globalThis.__TEMPLATE_CONFIG__||{})),globalThis.__PERSPECTIVE_CONFIG__}function se(e,t){switch(e){case"date":case"datetime":return t instanceof Date?t:new Date(parseInt(t)).toLocaleString([],Be(e).format);case"integer":return parseInt(t,10);case"float":return parseFloat(t)}return t}function ft(e,t){return t.crossValues.length===0?[]:e.crossValue.length===0?[]:((e.crossValue.split?e.crossValue.split("|"):Array.isArray(e.crossValue)?e.crossValue:[e.crossValue])||[e.key]).map((r,a)=>({name:t.crossValues[a].name,value:se(t.crossValues[a].type,r)}))}function ht(e,t){if(t.splitValues.length===0)return[];let n=[e.mainValue];return e.key?n=e.key.split("|"):e.mainValue?.split&&(n=e.mainValue.split("|")),t.splitValues.map((r,a)=>({name:r.name,value:se(r.type,n[a])}))}function gt(e,t){return t.mainValues.length>1?e.mainValues?t.mainValues.map((n,r)=>({name:n.name,value:se(n.type,e.mainValues[r])})):t.mainValues.map(n=>({name:n.name,value:se(n.type,e.row[n.name])})):[{name:t.mainValues[0].name,value:se(t.mainValues[0].type,e.colorValue||e.mainValue-e.baseValue||e.mainValue||e.mainValues)}]}function Fn(e,t,n){let r=ft(t,n).concat(ht(t,n)).concat(gt(t,n));no(e,r)}function no(e,t){e.select("#tooltip-values").selectAll("li").data(t).join("li").each(function(n){to(this).text(`${n.name}: `).append("b").text(ro(n.value))})}var ro=e=>e==null?"-":e.toLocaleString(void 0,{style:"decimal",minimumFractionDigits:Be("float").precision,maximumFractionDigits:Be("float").precision});var Rn=e=>[e.name,"==",e.value],Ze=(e,t,n)=>{let r=gt(t,n).map(l=>l.name),a=ft(t,n).map(Rn),o=ht(t,n).map(Rn),i=n.filter.concat(a).concat(o);e.dispatchEvent(new CustomEvent("perspective-click",{bubbles:!0,composed:!0,detail:{column_names:r,config:{filter:i},row:t.row}}))},Hn=()=>{let e=null,t=n=>{let r=n.node();n.on("click",(a,o)=>Ze(r,o,e))};return t.settings=(...n)=>n.length?(e=n[0],t):e,t};var ye=()=>{let e=!1,t=null,n=null,r=!1,a=o=>{let i=o.node();if(!i||!i.isConnected){Bn(t);return}let l=en(de(i));t=ao(l);let s=function(u,d){Fn(t,d,n);let m=o.nodes(),p=m.indexOf(this);oo(l.node(),m[p],t,r),en(m[p]).style("opacity","0.7")},c=function(u,d){Bn(t);let m=o.nodes(),p=m.indexOf(this);m&&en(m[p]).style("opacity","1")};e?o.each(function(u){return s.call(this,void 0,u)}):(o.on("mouseover",s).on("mouseout",c),Hn().settings(n)(o))};return a.alwaysShow=(...o)=>o.length?(e=o[0],a):e,a.centered=(...o)=>o.length?(r=o[0],a):r,a.settings=(...o)=>o.length?(n=o[0],a):n,a};function ao(e){return O(e,"div.tooltip",()=>e.append("div").attr("class","tooltip").style("z-index",3).style("opacity",0).html(zn))}function oo(e,t,n,r){let a=e.getBoundingClientRect(),o=t.getBoundingClientRect(),i=o.left+o.width/2-a.left,l=o.top-a.top+e.scrollTop;r&&(l=o.top+o.height/2-a.top+e.scrollTop),n.style("left",`${i}px`).style("top",`${l}px`).style("opacity",.9),r&&([i,l]=io(n,a)),lo(n,a,i,l,r)}function io(e,t){let n=e.node().getBoundingClientRect(),r=n.width/2,a=n.left-r-t.left;e.style("left",`${a}px`);let o=n.height/2,i=n.top-o-t.top;return e.style("top",`${i}px`),[a,i]}function lo(e,t,n,r,a=!1){let o=e.node().getBoundingClientRect();if(te(t,o)){let i=o.right-t.right;e.style("left",`${n-i}px`)}if(te(t,o,"bottom")){let i=o.bottom-t.bottom;e.style("top",`${r-i}px`)}if(!!a){if(te(t,o,"left")){let i=o.left-t.left;e.style("left",`${n-i}px`)}if(te(t,o,"top")){let i=o.top-t.top;e.style("top",`${r-i}px`)}}}function Bn(e){e&&e.style("opacity",0)}function yt(e,t){let n=e.mainValues.length>1?ce.seriesSvgGrouped(ce.seriesSvgBar()):ce.seriesSvgBar();return n=n.decorate(r=>{ye().settings(e)(r),r.style("fill",a=>t(a.key))}),ce.autoBandwidth(so(n)).crossValue(r=>r.crossValue).mainValue(r=>r.mainValue?r.mainValue:0).baseValue(r=>r.baseValue)}var so=e=>{let t=n=>e(n);return ce.rebindAll(t,e),t.bandwidth=(...n)=>n.length?(e.bandwidth(Math.max(n[0],1)),t):e.bandwidth(),t};import*as St from"d3";function xe(e){return e.split("|").slice(0,-1).join("|")}function xt(e,t){return e.data.map(n=>Object.entries(n).filter(([r,a])=>r.split("|").at(-1)===t&&!!a).map(([r,a])=>a)).flat()}function ne(e){let t=e.data&&e.data.length>0?e.data[0]:{},n=Object.keys(t).filter(r=>r!=="__ROW_PATH__");return Z().settings(e).domain(n)()}function In(e,t){let n=xt(e,t),r=[...new Set(n)].sort();return Z().settings(e).domain(r)()}function Te(e,t){let n=[...new Set(t)];return Z().settings(e).domain(n)()}function $n(e){let t=e.data[0]??{},n=Object.keys(t).filter(a=>a!=="__ROW_PATH__").map(a=>xe(a)),r=[...new Set(n)];return Z().settings(e).domain(r)()}function Z(){let e=null,t=null,n={},r=o=>De(o,n.colorStyles&&n.colorStyles.opacity),a=()=>{let o=n.colorStyles,i=t||[o.series];if(i||e.length>1){let l=e.length>1?o.scheme:i;return St.scaleOrdinal(l.map(r)).domain(e)}return null};return a.domain=(...o)=>o.length===0?e:(e=o[0],a),a.defaultColors=(...o)=>o.length?(t=o[0],a):t,a.mapFunction=(...o)=>o.length?(r=o[0],a):r,a.settings=(...o)=>o.length?(n=o[0],a):n,a}function re(e){return Le(1)(e)}function De(e,t=.5){return Le(t)(e)}function Le(e){return t=>{let n=St.color(t);return n!=null&&(n.opacity=e),n+""}}import{rebindAll as co}from"d3fc";var uo={none:It,ordinal:Xt,time:Ut,linear:Wt},U=e=>{let t=Ee(e),n="__ROW_PATH__",r=(a,o)=>uo[t()](n)(a);return co(r,t),r.valueName=(...a)=>a.length?(n=a[0],r):n,r};function ke(e,t,{stack:n=!1,excludeEmpty:r=!1}={}){let a=t||e.data;return e.splitValues.length>0?mo(e,a,{stack:n,excludeEmpty:r}):[a]}function mo(e,t,{stack:n=!1,excludeEmpty:r=!1}){let a={};return t.forEach(o=>{let i={},l={};Object.keys(o).filter(s=>s!=="__ROW_PATH__").filter(s=>!r||o[s]!=null&&o[s]!=null).forEach(s=>{let c=s.split("|"),u=c[c.length-1],d=o[s]||0,m=`${u}${d>=0?"+ve":"-ve"}`,p=c.slice(0,c.length-1).join("|"),f=l[p]=l[p]||{__ROW_PATH__:o.__ROW_PATH__},h=i[m]||0;f.__KEY__=p,n?(f[u]=h+d,f[`__BASE_VALUE__${u}`]=h,i[m]=f[u]):f[u]=d,f.row=o}),Object.keys(l).forEach(s=>{(a[s]=a[s]||[]).push(l[s])})}),Object.keys(a).map(o=>{let i=a[o];return i.key=o,i})}function Gn(e,t){let n={stack:!1},r=ke(e,t,n).map(a=>jn(e,a,n));return e.mainValues.length>1?r.reduce((o,i)=>o.concat(i)):r}function bt(e,t){let n={stack:!0};return ke(e,t,n).map(r=>jn(e,r,n))}function po(e,t,{stack:n=!1}){let r=U(e);return a=>{let o=l=>n&&l[`__BASE_VALUE__${a.name}`]||0,i=t.map((l,s)=>({crossValue:r(l,s),mainValue:l[a.name]?l[a.name]:null,baseValue:o(l),key:l.__KEY__?`${l.__KEY__}|${a.name}`:a.name,row:l.row||l}));return i.key=i[0].key,i}}function jn(e,t,{stack:n=!1}){let r=po(e,t,{stack:n});return e.mainValues.length>1?e.mainValues.map(r):r(e.mainValues[0])}import*as vt from"d3";import*as wt from"d3-svg-legend";import*as nr from"d3-svg-legend";import{rebindAll as _o}from"d3fc";var Wn=`<span id="up-arrow">&#9650;</span>
<span id="page-text"></span>
<span id="down-arrow">&#9660;</span>
`;function Yn(e){let t=e.select("g.legendCells"),n=e.node().getBoundingClientRect();if(!te(n,t.node().getBoundingClientRect()))return;let r=e.select(".legend");t.selectAll(".label").text((a,o,i)=>{let l=i[o];if(te(n,l.getBoundingClientRect())){let s=ho(l,r,n);return`${a.substring(0,s-3)}...`}else return a})}function ho(e,t,n){let r=e.getBoundingClientRect(),a=t.node().createSVGPoint(),o=3;return a.x=n.right-r.left-o,a.y=0,e.getCharNumAtPosition(a)}import*as Me from"d3";import*as Un from"d3";var Ne=10;function Se(e,t,n){let r=Un.select(Fe(e).getContainer()).node().getBoundingClientRect(),a=e.getBoundingClientRect(),o={top:a.top+n-Ne,right:a.right+t+Ne,bottom:a.bottom+n+Ne,left:a.left+t-Ne},i={x:t,y:n};return[{edge:"right",dimension:"x"},{edge:"left",dimension:"x"},{edge:"top",dimension:"y"},{edge:"bottom",dimension:"y"}].forEach(s=>{if(te(r,o,s.edge)){let c=o[s.edge]-r[s.edge];i[s.dimension]=i[s.dimension]-c}}),i}var tn="resize.for-dragging";function Kn(){let e=!0,t=null,n=r=>{let a=r.node(),o=a.getRootNode().host.closest("perspective-viewer");a.style.cursor="move",t.legend&&(a.style.left=t.legend.left,a.style.top=t.legend.top);let i=Me.drag().on("drag",function(l){let s=Se(this,l.dx,l.dy);this.style.left=`${this.offsetLeft+s.x}px`,this.style.top=`${this.offsetTop+s.y}px`;let c={left:this.style.left,top:this.style.top};t.legend={...t.legend,...c},e=xo(a)?yo(a):go(a,e)});i.on("end",function(l){Me.select(window).on(tn,null),o?.dispatchEvent(new Event("perspective-config-update"))}),r.call(i)};return n.settings=(...r)=>r.length?(t=r[0],n):t,n}function go(e,t){return t!==!1&&Me.select(window).on(tn,function(){let n=Se(e,0,0);e.style.left=`${e.offsetLeft+n.x}px`,e.style.top=`${e.offsetTop+n.y}px`}),!1}function yo(e){return Me.select(window).on(tn,null),e.style.left="auto",!0}function xo(e){let t=e.getBoundingClientRect(),n=Me.select(de(e)).node().getBoundingClientRect(),r=5;return t.right+Ne+r>=n.right&&t.top-Ne-r<=n.top}import*as Je from"d3";var Xn="horizontal-drag-handle",qn="vertical-drag-handle",So="corner-drag-handle",Jn="dragHandles",Zn=0,be="resize";function Qn(){let e=9,t=3,n=null,r={height:100,width:100},a={height:null,width:null},o=[],i=(u,d)=>o.filter(m=>m.event===u).forEach(m=>m.execute(d)),l=u=>{if(vo(u))return;let d={left:w=>i(be,{horizontal:J(w),vertical:!1}),top:w=>i(be,{horizontal:!1,vertical:oe(w)}),right:w=>i(be,{horizontal:X(w),vertical:!1}),bottom:w=>i(be,{horizontal:!1,vertical:q(w)}),topleft:w=>i(be,{horizontal:J(w),vertical:oe(w)}),topright:w=>i(be,{horizontal:X(w),vertical:oe(w)}),bottomright:w=>i(be,{horizontal:X(w),vertical:q(w)}),bottomleft:w=>i(be,{horizontal:J(w),vertical:q(w)})},m=u.node();n.legend&&(m.style.height=n.legend.height,m.style.width=n.legend.width);let p=m.getBoundingClientRect(),f=u.append("svg").attr("id",Jn).attr("width",p.width).attr("height",p.height),h=f.append("g"),y=w=>w==="left"||w==="right",g={left:0,top:e,right:p.width-e,bottom:e},x={left:e,top:0,right:e,bottom:p.height-e},b=["left","top","right","bottom"],[S,v,V,D]=b.map(w=>h.append("rect").attr("id",`drag${w}`).attr("class",y(w)?qn:Xn).attr("y",x[w]).attr("x",g[w]).attr("height",y(w)?p.height-e*2:e).attr("width",y(w)?e:p.width-e*2).attr("fill",y(w)?"lightgreen":"lightblue").attr("fill-opacity",Zn).style("z-index",t).attr("cursor",y(w)?"ew-resize":"ns-resize").call(Je.drag().on("drag",d[w]))),I=w=>`${w[0]}${w[1]}`,j={topleft:"nwse",topright:"nesw",bottomright:"nwse",bottomleft:"nesw"},k=[["top","left"],["top","right"],["bottom","right"],["bottom","left"]],[N,$,M,F]=k.map(w=>h.append("rect").attr("id",`drag${I(w)}`).attr("class",`${So} ${w[0]} ${w[1]}`).attr("height",e).attr("width",e).attr("fill","red").attr("fill-opacity",Zn).style("z-index",t).attr("cursor",`${j[I(w)]}-resize`).call(Je.drag().on("drag",d[I(w)])));ie("height","y",D),ie("width","x",V),E(f);function J(w){let T=c(Se(S.node(),w.x,0).x,f,"width",(G,le)=>G-le);return m.style.left=`${m.offsetLeft+T}px`,m.style.width=`${m.offsetWidth-T}px`,Q(),_(V,T,"width","x")}function X(w){let T=-c(Se(V.node(),w.dx,0).x,f,"width",(G,le)=>G+le);return s(T,"x",V,w)?!1:(m.style.width=`${m.offsetWidth-T}px`,Q(),_(V,T,"width","x"))}function oe(w){let T=c(Se(v.node(),0,w.y).y,f,"height",(G,le)=>G-le);return m.style.top=`${m.offsetTop+T}px`,m.style.height=`${m.offsetHeight-T}px`,Q(),_(D,T,"height","y")}function q(w){let T=-c(Se(D.node(),0,w.dy).y,f,"height",(G,le)=>G+le);return s(T,"y",D,w)?!1:(m.style.height=`${m.offsetHeight-T}px`,Q(),_(D,T,"height","y"))}function Q(){let w={top:m.style.top,left:m.style.left,height:m.style.height,width:m.style.width};n.legend={...n.legend,...w}}function _(w,T,G,le){return Vo(f,G,T),wo(w,le,T),bo(f,T,G,G==="height"?qn:Xn),E(f),T!=0}function E(w){N.attr("y",0),$.attr("y",0).attr("x",w.attr("width")-e),M.attr("y",w.attr("height")-e).attr("x",w.attr("width")-e),F.attr("y",w.attr("height")-e).attr("x",0)}function ie(w,T,G){!!a[w]&&a[w]<p[w]&&(m.style[w]=`${a[w]}px`,_(G,p[w]-a[w],w,T))}};l.on=(u,d)=>(o.push({event:u,execute:d}),l),l.zIndex=u=>(t=u,l),l.settings=(...u)=>u.length?(n=u[0],l):n,l.minWidth=u=>(r.width=u,a.width&&(a.width=Math.max(r.width,a.width)),l),l.minHeight=u=>(r.height=u,a.height&&(a.height=Math.max(r.height,a.height)),l),l.handleWidth=u=>(e=u,l),l.maxWidth=u=>(a.width=u,r.width=Math.min(r.width,a.width),l),l.maxHeight=u=>(a.height=u,r.height=Math.min(r.height,a.height),l);function s(u,d,m,p){let f=(y,g,x,b)=>y<0&&b[g]<Number(x.attr(g)),h=(y,g,x,b)=>y>0&&b[g]>Number(x.attr(g));return f(u,d,m,p)||h(u,d,m,p)}function c(u,d,m,p){let f=p(Number(d.attr(m)),u);if(f<r[m]){let h=r[m]-f;return p(u,h)}if(!!a[m]&&f>a[m]){let h=a[m]-f;return p(u,h)}return u}return l}var bo=(e,t,n,r)=>{e.selectAll(`.${r}`).each((o,i,l)=>{let s=l[i];Je.select(s).attr(n,s.getBoundingClientRect()[n]-t)})},vo=e=>e.select(`#${Jn}`).size()>0,wo=(e,t,n)=>e.attr(t,Number(e.attr(t))-n),Vo=(e,t,n)=>e.attr(t,e.node().getBoundingClientRect()[t]-n);var er=16,tr=20,nn=(e,t)=>{let n=e||nr.legendColor(),r=[],a=1,o,i=t.legend&&t.legend.pageIndex?t.legend.pageIndex:0,l=()=>{},s=Kn().settings(t),c,u=S=>{r=n.scale().domain(),c=Qn().settings(t).maxHeight(r.length*er+tr).on("resize",()=>d(S)),c(S),s(S),d(S)},d=S=>{y(S),m(S),p(S),Yn(S)},m=S=>{let v=x(S);v.style("display",a<=1?"none":"block"),v.select("#page-text").text(`${i+1}/${a}`),v.select("#up-arrow").attr("class",i===0?"disabled":"").on("click",()=>{i>0&&(f(i-1),d(S))}),v.select("#down-arrow").attr("class",i>=a-1?"disabled":"").on("click",()=>{i<a-1&&(f(i+1),d(S))})},p=S=>{a>1&&n.cellFilter(h()),S.select("g.legendCells").remove();let v=b(S);v.call(n);let V=S.select("g.legendCells").node().getBBox();v.attr("height",V.height+tr),l(S)},f=S=>{i=S,t.legend={...t.legend,pageIndex:i}},h=()=>(S,v)=>v>=o*i&&v<o*i+o,y=S=>{let v=S.node().getBoundingClientRect(),V=Math.floor(v.height/er)-1;o=V<r.length?V-1:V,a=g(V),i=Math.min(i,a-1)},g=S=>Math.ceil(r.length/S),x=S=>O(S,".legend-controls",()=>S.append("g").attr("class","legend-controls").html(Wn)),b=S=>O(S,".legend",()=>S.append("svg").attr("class","legend"));return u.decorate=(...S)=>S.length?(l=S[0],u):l,_o(u,n),u};var rr=e=>nn(wt.legendColor().shape("circle").shapeRadius(6),e),Co=e=>nn(wt.legendSymbol().shapePadding(1).labelOffset(3),e),R=()=>rn(rr),Qe=()=>rn(Co,or),ar=()=>rn(rr,or);function or(e){if(!e)return null;let t=e.domain(),n=e.range().map(r=>vt.symbol().type(r)());return vt.scaleOrdinal().domain(t).range(n)}function rn(e,t=void 0){let n={},r=null,a=null,o=i=>{if(r&&r.range().length>1){let l=e(n);l.scale(r).orient("vertical").on("cellclick",function(c){let u=this.__data__;n.hideKeys=n.hideKeys||[],n.hideKeys.includes(u)?n.hideKeys=n.hideKeys.filter(d=>d!==u):n.hideKeys.push(u),Fe(this)._draw()}),l.labels(c=>{let u=String(c.domain[c.i]).split("|");return n.mainValues.length<=1&&u.length>1?u.slice(0,u.length-1).join("|"):c.domain[c.i]});let s=O(i,"div.legend-container",()=>i.append("div"));l.decorate(c=>{let u=m=>n.hideKeys&&n.hideKeys.includes(m),d=c.select("g.legendCells").attr("transform","translate(20,20)").selectAll("g.cell");d.classed("hidden",u),d.append("title").html(m=>m),a&&d.select("circle, path").style("fill",m=>u(m)?null:a(m)).style("stroke",m=>u(m)?null:re(a(m)))}),s.attr("class","legend-container").attr("borderbox-on-hover",!0).style("z-index","2").call(l)}};return o.settings=(...i)=>i.length===0?n:(n=i[0],o),o.scale=(...i)=>i.length?(r=t?t(i[0]):i[0],o):r,o.color=(...i)=>i.length?(a=i[0],o):a,o}function K(e,t=void 0){let n=t||e.data;return(e.hideKeys?.length??0)>0?n.map(a=>{let o={...a};return e.hideKeys.forEach(i=>{delete o[i]}),o}):n}function Ie(e){let t=e.data,n=e.hideKeys?.length??0,r=e.splitValues.length;return n>0?r===0?t.filter(a=>Object.values(a).reduce((o,i)=>o&&!e.hideKeys.includes(i),!0)):t.map(a=>{let o=Object.entries(a).filter(([i,l])=>!e.hideKeys.includes(xe(i)));return Object.fromEntries(o)}):t}import*as ve from"d3fc";var Ao=e=>t=>t.style("stroke-width","1.0").style("stroke",e?e.colorStyles.grid.gridLineColor:"#bbb"),To=e=>t=>{t.strokeStyle=e?e.colorStyles.grid.gridLineColor:"#bbb",t.lineWidth=1},Do=e=>e.style("display","none"),Lo=e=>t=>{t.lineWidth=1,t.strokeStyle=e?e.colorStyles.grid.gridLineColor:"#bbb"},z=(e,t)=>{let n="both",r=!1,a=null,o=null,i=null,l=ve.seriesSvgMulti(),s=ve.annotationSvgGridline(),c=Ao(t),u=Do,d=function(...m){r&&(l=ve.seriesCanvasMulti().context(i),s=ve.annotationCanvasGridline(),c=To(t),u=Lo(t));let p=l.xScale(a).yScale(o),f=n==="vertical"?u:c,h=n==="horizontal"?u:c,y=s.xDecorate(f).yDecorate(h);return p.series([y,e])(...m)};return d.orient=(...m)=>m.length?(n=m[0],d):n,d.canvas=(...m)=>m.length?(r=m[0],d):r,d.xScale=(...m)=>m.length?(a=m[0],d):a,d.yScale=(...m)=>m.length?(o=m[0],d):o,d.context=(...m)=>m.length?(i=m[0],d):i,d};import*as ir from"d3fc";var H=()=>{let e=ct(),t=n=>{let r=e.pad(),a=e.padUnit(),o=1;switch(a){case"domain":break;case"percent":{o=n[1]-n[0];break}default:throw new Error("Unknown padUnit: "+a)}let i=n[0]-r[0]*o,l=n[1]+r[1]*o;return n[0]=n[0]>=0&&i<0?0:i,n[1]=n[1]<=0&&l>0?0:l,n};return t.pad=function(...n){return e.pad()},t.padUnit=function(...n){return e.padUnit()},ir.rebindAll(t,e),t};import*as $e from"d3";var lr=`<button id="zoom-reset">Reset zoom</button>
<button id="one-year">1 Year</button>
<button id="six-months">6 Months</button>
<button id="one-month">1 Month</button>
`;var P=()=>{let e=null,t=null,n=null,r=null,a=null,o=null,i=!1,l=!1,s=()=>{};function c(p){let f=`d3fc-${l?"canvas":"svg"}.plot-area`;if(n||a){let h=r&&r.domain()[0]instanceof Date,y=$e.zoom().on("zoom",x=>{let{transform:b}=x;t.zoom={k:b.k,x:b.x,y:b.y},u(b),p.call(e);let S=b.k===1&&b.x===0&&b.y===0,v=d(p).style("display",S?"none":"");v.select("#zoom-reset").on("click",()=>p.select(f).call(y.transform,$e.zoomIdentity));let V=v.select("#one-year").style("display",h?"":"none"),D=v.select("#six-months").style("display",h?"":"none"),I=v.select("#one-month").style("display",h?"":"none");if(h){let j=k=>()=>{let N=new Date(n.domain()[0]),$=new Date(N);k(N,$);let M=r.range(),F=(M[1]-M[0])/(r($)-r(N)),J=-r(N)*F,X=0;if(a){let oe=a.domain().reduce((q,Q)=>q+Q)/2;X=-o(oe)*F+a(oe)}p.select(f).call(y.transform,$e.zoomIdentity.translate(J,X).scale(F))};V.on("click",j((k,N)=>N.setYear(k.getFullYear()+1))),D.on("click",j((k,N)=>N.setMonth(k.getMonth()+6))),I.on("click",j((k,N)=>N.setMonth(k.getMonth()+1)))}}),g=e.decorate();e.decorate((x,b)=>{if(g(x,b),!i){i=!0;let S=x.select(f),v=l?window.devicePixelRatio:1;S.on("measure.zoom-range",V=>{if(r&&r.range([0,V.detail.width/v]),o&&o.range([0,V.detail.height/v]),t.zoom){let D=$e.zoomIdentity.translate(t.zoom.x,t.zoom.y).scale(t.zoom.k);S.call(y.transform,D)}}).call(y)}})}p.call(e)}c.chart=(...p)=>p.length?(e=p[0],c):e,c.settings=(...p)=>p.length?(t=p[0],c):t,c.xScale=(...p)=>p.length?(n=m(p[0]),r=n?n.copy():null,c):n,c.yScale=(...p)=>{if(!p.length)return a;if(a=m(p[0]),o=a?a.copy():null,o){let f=o.domain();o.domain([f[1],f[0]])}return c},c.canvas=(...p)=>p.length?(l=p[0],c):l,c.onChange=(...p)=>p.length?(s=p[0],c):s;let u=p=>{let f={...p};if(n&&(n.domain(p.rescaleX(r).domain()),f.xDomain=n.domain()),a){let h=p.rescaleY(o).domain();a.domain([h[1],h[0]]),f.yDomain=a.domain()}s(f)},d=p=>O(p,".zoom-controls",()=>p.append("div").attr("class","zoom-controls").style("display","none").html(lr)),m=p=>p&&p.nice?p:null;return c};function cr(e,t){let n=bt(t,K(t)),r=ne(t),a=R().settings(t).scale(r),o=yt(t,r).orient("horizontal"),i=sr.seriesSvgMulti().mapping((d,m)=>d[m]).series(n.map(()=>o)),l=A(t).settingName("mainValues").valueName("mainValue").memoValue(t.axisMemo[0]).excludeType(C.ordinal).include([0]).paddingStrategy(H())(n),s=A(t).excludeType(C.linear).settingName("crossValues").valueName("crossValue").orient("vertical")(n),c=Y(l,s).plotArea(z(i,t).orient("horizontal"));c.yPaddingInner&&(c.yPaddingInner(.5),c.yPaddingOuter(.25),o.align("left")),c.xNice&&c.xNice();let u=P().chart(c).settings(t).yScale(s.scale);e.datum(n).call(u),e.call(a)}cr.plugin={name:"X Bar",category:"X Chart",max_cells:1e3,max_columns:50,render_warning:!0,initial:{names:["X Axis"]}};var ur=cr;import*as xr from"d3fc";var fr=(e,t)=>{if(!mr(e)||!mr(t))return;let n=pr(e),r=pr(t);n>r?t[0]=dr(t,n):e[0]=dr(e,r)},mr=e=>e.length===2&&!isNaN(e[0])&&!isNaN(e[1])&&e[0]!==e[1],pr=e=>(0-e[0])/(e[1]-e[0]),dr=(e,t)=>t*e[1]/(t-1);import*as hr from"d3fc";var gr=e=>{let t=[],n=!1,r,a=i=>{i.text("");let l=hr.dataJoin("span","splitter-label").key(u=>u),s=!n&&t.length===1,c=r&&e.splitValues.length===0;l(i,t).classed("disabled",s).text(u=>u.name).style("color",u=>c?re(r(u.name)):void 0).on("click",(u,d)=>{s||(n?e.splitMainValues=e.splitMainValues.filter(m=>m!=d.name):e.splitMainValues=[d.name].concat(e.splitMainValues||[]),u.target.getRootNode().host.closest("perspective-viewer")?.dispatchEvent(new Event("perspective-config-update")),o(i))})},o=i=>{let l=Fe(i.node());l._container.innerHTML="",l._draw()};return a.labels=(...i)=>i.length?(t=i[0],a):t,a.alt=(...i)=>i.length?(n=i[0],a):n,a.color=(...i)=>i.length?(r=i[0],a):r,a};var we=(e,t,n=No)=>{let r,a,o,i=e.splitMainValues||[],l=u=>{let d=u.split("|");return i.includes(d[d.length-1])},s=e.mainValues.some(u=>l(u.name));a=s?n(t,u=>!l(u)):t,o=s?n(t,l):null;let c=u=>{if(e.mainValues.length===1)return;let d=e.mainValues.map((h,y)=>({index:y,name:h.name})),m=d.filter(h=>!l(h.name)),p=d.filter(h=>l(h.name)),f=()=>gr(e).color(r);u.select(".y-label.left-label").call(f().labels(m)),u.select(".y-label.right-label").call(f().labels(p).alt(!0))};return c.color=(...u)=>u.length?(r=u[0],c):r,c.haveSplit=()=>s,c.data=(...u)=>u.length?(a=u[0],c):a,c.altData=(...u)=>u.length?(o=u[0],c):o,c},No=(e,t)=>e.map(n=>n.filter(r=>t(r.key))),an=(e,t)=>e.map(n=>t(n.key)?n:n.map(r=>Object.assign({},r,{mainValue:null}))),yr=(e,t)=>e.map(n=>an(n,t));function Sr(e,t){let n=bt(t,K(t)),r=ne(t),a=R().settings(t).scale(r),o=yt(t,r).orient("vertical"),i=xr.seriesSvgMulti().mapping((h,y)=>h[y]).series(n.map(()=>o)),l=A(t).excludeType(C.linear).settingName("crossValues").valueName("crossValue")(n),s=A(t).settingName("mainValues").valueName("mainValue").memoValue(t.axisMemo[1]).excludeType(C.ordinal).orient("vertical").include([0]).paddingStrategy(H()),c=t.mainValues.length>1?yr:an,u=we(t,n,c).color(r),d=s(u.data()),m=u.haveSplit()?i:z(i,t).orient("vertical"),p=Y(l,d).axisSplitter(u).plotArea(m);p.xPaddingInner&&(p.xPaddingInner(.5),p.xPaddingOuter(.25),o.align("left")),p.yNice&&p.yNice();let f=P().chart(p).settings(t).xScale(l.scale);if(u.haveSplit()){let h=s(u.altData());fr(d.domain,h.domain),p.yDomain(d.domain).altAxis(h)}e.datum(u.data()).call(f),e.call(a)}Sr.plugin={name:"Y Bar",category:"Y Chart",max_cells:1e3,max_columns:50,render_warning:!0,initial:{names:["Y Axis"]}};var br=Sr;import*as Vr from"d3fc";import*as vr from"d3fc";function Ge(e,t){let n=vr.seriesSvgLine(),r=e.data.length*(e.data?.length>0?Object.keys(e.data[0]).length-(e.crossValues?.length>0?1:0):0),a=Math.max(1,Math.min(3,Math.floor(e.size.width/r/2)));return n=n.decorate(o=>{o.style("stroke",i=>re(t(i[0]&&i[0].key))).style("stroke-width",a)}),n.crossValue(o=>o.crossValue).mainValue(o=>o.mainValue)}function wr(e,t){let n=U(e);return t.map((r,a)=>Object.keys(r).filter(o=>o!=="__ROW_PATH__").map(o=>({key:o,crossValue:n(r,a),mainValue:r[o],row:r})))}var Vt=function(e){let t=[];for(let n of e)for(let r=0;r<n.length;r++)n[r].mainValue!==null&&(t[r]=t[r]||[],t[r].push(n[r]));return t};import*as _t from"d3fc";var on=(e,t,n=Math.min)=>{let r=i=>i.reduce((l,s)=>{let c=a(s);return c&&(!l||n(l.value,c.value)===c.value)?c:l},null),a=i=>{if(Array.isArray(i))return r(i);let l=t(i);return l!==null?{item:i,value:l}:null},o=r(e);return o?o.item:null};var W=()=>{let e=ye().alwaysShow(!0),t=null,n=null,r=null,a=null,o=!1,i=null,l="crossValue",s="mainValue",c=null,u=1,d=f=>{let h=`d3fc-${o?"canvas":"svg"}.plot-area`;if(t||n){let y=null,g=_t.pointer().on("point",x=>{let b=x.length?p(x[0]):null;y=b?[b.data]:[];let S=b?b.scale:n;m(f,y,S)});f.select(h).on("measure.nearbyTip",()=>m(f,[])).on("click",()=>{y.length&&Ze(f.node(),y[0],e.settings())}).call(g)}},m=(f,h,y=n)=>{let g=f.select("d3fc-svg.plot-area svg").selectAll("circle.nearbyTip").data(h);g.exit().remove(),g.enter().append("circle").attr("class","nearbyTip").merge(g).attr("r",x=>a?u*Math.sqrt(a(x.size)):10).attr("transform",x=>`translate(${t(x[l])},${y(x[s])})`).style("stroke","none").style("fill",x=>r&&x.key&&De(r(x.key))),e(g)},p=f=>{let h=x=>b=>b[s]===void 0||b[s]===null||b[l]===void 0||b[l]===null?null:Math.sqrt(Math.pow(t(b[l])-f.x,2)+Math.pow(x(b[s])-f.y,2)),y=h(n),g=on(i,y,Math.min);if(c){let x=h(c.yScale),b=on(c.data,x,Math.min);return y(g)<=x(b)?{data:g,scale:n}:{data:b,scale:c.yScale}}return{data:g,scale:n}};return d.scaleFactor=(...f)=>f.length?(u=f[0],d):u,d.xScale=(...f)=>f.length?(t=f[0],d):t,d.yScale=(...f)=>f.length?(n=f[0],d):n,d.color=(...f)=>f.length?(r=f[0],d):r,d.size=(...f)=>f.length?(a=f[0]?f[0].copy().range([40,4e3]):null,d):a,d.canvas=(...f)=>f.length?(o=f[0],d):o,d.data=(...f)=>f.length?(i=f[0],d):i,d.xValueName=(...f)=>f.length?(l=f[0],d):l,d.yValueName=(...f)=>f.length?(s=f[0],d):s,d.altDataWithScale=(...f)=>f.length?(c=f[0],d):c,d.settings=(...f)=>f.length?(e.settings(f[0]),d):e.settings(),_t.rebindAll(d,e),d};function _r(e,t){let n=wr(t,K(t)),r=ne(t),a=R().settings(t).scale(r),o=Vr.seriesSvgRepeat().series(Ge(t,r)).orient("horizontal"),i=H().pad([.1,.1]).padUnit("percent"),l=we(t,Vt(n)).color(r),s=A(t).excludeType(C.linear).settingName("crossValues").valueName("crossValue")(n),c=A(t).settingName("mainValues").valueName("mainValue").memoValue(l.haveSplit()?null:t.axisMemo[0]).orient("vertical").paddingStrategy(i),u=c(l.data()),d=l.haveSplit()?o:z(o,t).orient("vertical"),m=Y(s,u).axisSplitter(l).plotArea(d);m.yNice&&m.yNice();let p=P().chart(m).settings(t).xScale(s.scale),f=W().settings(t).xScale(s.scale).yScale(u.scale).color(r).data(n);if(l.haveSplit()){let y=c(l.altData());m.altAxis(y),f.data(l.data()).altDataWithScale({yScale:y.scale,data:l.altData()})}let h=l.data();e.datum(h).call(p),e.call(f),e.call(a)}_r.plugin={name:"Y Line",category:"Y Chart",max_cells:4e3,max_columns:50,render_warning:!0,initial:{names:["Y Axis"]}};var Cr=_r;import*as kr from"d3fc";import{seriesCanvasPoint as zo}from"d3fc";import*as L from"d3";var ln=Math.sqrt(3),Mo={draw:function(e,t){let n=Math.sqrt(t/(ln*3));e.moveTo(0,n*2),e.lineTo(-ln*n,-n),e.lineTo(ln*n,-n),e.closePath()}},Oo=[L.symbolCircle,L.symbolCross,L.symbolDiamond,L.symbolSquare,L.symbolStar,L.symbolTriangle,L.symbolWye],sn={circle:L.symbolCircle,square:L.symbolSquare,cross:L.symbolCross,diamond:L.symbolDiamond,star:L.symbolStar,triangle:L.symbolTriangle,wye:L.symbolWye,nabla:Mo};function et(e){return e.length>1?L.scaleOrdinal().domain(e).range(Oo):null}var Po=8,Eo=1;function Ar(e,t,n,r,a,o,i=1){let l=zo().crossValue(s=>s.x).mainValue(s=>s.y);return o&&l.type(s=>o(s.row[t])),n&&l.size(s=>Math.round(i*n(s.size))),l.decorate((s,c)=>{let u=r(c.colorValue),d=e.colorStyles?.opacity;if(a){let{type:m}=e.mainValues.find(f=>f.name===a),p=se(m,c.row[a]);if(p!==null){s.fillStyle=e.textStyles.color,s.font=e.textStyles.font;let f=0;n&&(f=Math.sqrt(i*n(c.size)/Math.PI)*Eo);let h=f+Po;s.fillText(p,h,4)}}s.strokeStyle=re(u),s.fillStyle=De(u,d)}),l}function Tr(e,t){let n=[...new Set(xt(e,t))];return et(n)}function Dr(e){let t=e.data&&e.data.length>0?e.data[0]:{},n=[];return Object.keys(t).forEach(r=>{if(r!=="__ROW_PATH__"){let a=xe(r);n.includes(a)||n.push(a)}}),et(n)}function Lr(e,t){let n=e.mainValues.length;return t.map(r=>{let a=Object.keys(r).filter(i=>i!=="__ROW_PATH__"),o=new Array(a.length/n);for(let i=0;i<a.length/n;i++)o[i]={key:xe(a[i*n]),crossValue:r[a[i*n]],mainValue:r[a[i*n+1]],row:r};return o})}function Nr(e,t){let n=Vt(Lr(t,Ie(t))),r=$n(t),a=Dr(t),o=null;r.domain().length>=2&&(o=ar().settings(t).scale(a).color(r));let i=kr.seriesSvgRepeat().series(Ge(t,r)).orient("horizontal"),l=H().pad([.1,.1]).padUnit("percent"),s=A(t).settingName("mainValues").settingValue(t.mainValues[0].name).valueName("crossValue").memoValue(t.axisMemo[0]).paddingStrategy(l),u=A(t).settingName("mainValues").settingValue(t.mainValues[1].name).valueName("mainValue").memoValue(t.axisMemo[1]).orient("vertical").paddingStrategy(l)(n),d=s(n),m=z(i,t).orient("vertical"),p=Y(d,u).xLabel(t.mainValues[0].name).yLabel(t.mainValues[1].name).plotArea(m);p.xNice&&p.xNice(),p.yNice&&p.yNice();let f=P().chart(p).settings(t).xScale(d.scale).yScale(u.scale),h=W().settings(t).xScale(d.scale).yScale(u.scale).color(r).data(n);e.datum(n).call(f),e.call(h),o&&e.call(o)}Nr.plugin={name:"X/Y Line",category:"X/Y Chart",max_cells:5e4,max_columns:50,render_warning:!0,initial:{type:"number",count:2,names:["X Axis","Y Axis","Tooltip"]},selectMode:"toggle"};var Mr=Nr;import*as tt from"d3fc";import*as Or from"d3fc";function zr(e,t){let n=Or.seriesSvgArea();return n=n.decorate(r=>{r.style("fill",a=>t(a[0].key)).style("opacity",.5)}),n.crossValue(r=>r.crossValue).mainValue(r=>r.mainValue).baseValue(r=>r.baseValue)}function Pr(e,t){let n=U(e);return t.map((r,a)=>{let o={};return Object.keys(r).filter(i=>i!=="__ROW_PATH__").map(i=>{let l=i.split("|"),s=l[l.length-1],c=o[s]||0,u=c+r[i];return o[s]=u,{key:i,crossValue:n(r,a),mainValue:u,baseValue:c,row:r}})})}function Er(e,t){let n=Pr(t,K(t)),r=ne(t),a=R().settings(t).scale(r),o=tt.seriesSvgRepeat().series(zr(t,r).orient("vertical")),i=tt.seriesSvgRepeat().series(Ge(t,r)).orient("vertical"),l=tt.seriesSvgMulti().series([o,i]),s=A(t).excludeType(C.linear).settingName("crossValues").valueName("crossValue")(n),c=A(t).settingName("mainValues").valueName("mainValue").memoValue(t.axisMemo[1]).excludeType(C.ordinal).orient("vertical").include([0]).paddingStrategy(H()),u=we(t,n).color(r),d=c(u.data()),m=u.haveSplit()?l:z(l,t).orient("vertical"),p=Y(s,d).axisSplitter(u).plotArea(m);p.yNice&&p.yNice();let f=P().chart(p).settings(t).xScale(s.scale),h=W().settings(t).xScale(s.scale).yScale(d.scale).color(r).data(n);if(u.haveSplit()){let y=c(u.altData());p.altAxis(y),h.data(u.data()).altDataWithScale({yScale:y.scale,data:u.altData()})}e.datum(u.data()).call(f),e.call(h),e.call(a)}Er.plugin={name:"Y Area",category:"Y Chart",max_cells:4e3,max_columns:50,render_warning:!0,initial:{names:["Y Axis"]}};var Fr=Er;import*as Ir from"d3fc";import*as Rr from"d3fc";function Hr(e,t,n,r){let a=Rr.seriesSvgPoint().size(100),o=e.colorStyles&&e.colorStyles.opacity;return r&&a.type(r(t)),a.decorate(i=>{i.style("stroke",l=>re(n(l.colorValue||t))).style("fill",l=>De(n(l.colorValue||t),o))}),a.crossValue(i=>i.crossValue).mainValue(i=>i.mainValue)}function Br(e){let t=e.data&&e.data.length>0?e.data[0]:{},n=Object.keys(t).filter(r=>r!=="__ROW_PATH__");return et(n)}function $r(e,t){let n=Gn(t,K(t)),r=Br(t),a=ne(t),o=Qe().settings(t).scale(r).color(a),i=Ir.seriesSvgMulti().mapping((y,g)=>y[g]).series(n.map(y=>Hr(t,y.key,a,r))),l=H().pad([.05,.05]).padUnit("percent"),s=A(t).excludeType(C.linear).settingName("crossValues").valueName("crossValue")(n),c=A(t).settingName("mainValues").valueName("mainValue").memoValue(t.axisMemo[1]).orient("vertical").paddingStrategy(l),u=we(t,n).color(a),d=c(u.data()),m=u.haveSplit()?i:z(i,t).orient("vertical"),p=Y(s,d).axisSplitter(u).plotArea(m);p.yNice&&p.yNice();let f=P().chart(p).settings(t).xScale(s.scale),h=W().settings(t).xScale(s.scale).yScale(d.scale).color(a).data(n);if(u.haveSplit()){let y=c(u.altData());p.altAxis(y),h.data(u.data()).altDataWithScale({yScale:y.scale,data:u.altData()})}e.datum(u.data()).call(f),e.call(h),o&&e.call(o)}$r.plugin={name:"Y Scatter",category:"Y Chart",max_cells:4e3,max_columns:50,render_warning:!0,initial:{names:["Y Axis"]}};var Gr=$r;import*as nt from"d3";function jr(e,t){return ke(e,t,{excludeEmpty:!0}).map(n=>Fo(e,n))}function Fo(e,t){let n=U(e),r=t.map((a,o)=>({crossValue:n(a,o),mainValues:e.mainValues.map(i=>a[i.name]),x:a[e.mainValues[0].name],y:a[e.mainValues[1].name],colorValue:e.realValues[2]?a[e.realValues[2]]:void 0,size:e.realValues[3]?a[e.realValues[3]]:void 0,key:t.key,row:a}));return r.key=t.key,r}import*as je from"d3";function Wr(e,t,n,r){return je.scaleLinear().domain(Yr(t,n,r))}function Ve(e,t,n,r=null){let a=Yr(t,n,r),o=e.colorStyles.gradient.full;if(a[0]>=0)o=e.colorStyles.gradient.positive;else if(a[1]<=0)o=e.colorStyles.gradient.negative;else{let l=Math.max(-a[0],a[1]);a=[-l,l]}let i=Ro(o);return je.scaleSequential(i).domain(a)}var Yr=(e,t,n)=>n||jt().valueName(t).pad([0,0])(e),Ro=e=>{let t=e.slice(1).map((n,r)=>je.interpolate(e[r][1],n[1]));return n=>{let r=e.findIndex((l,s)=>s<e.length-1&&n<=e[s+1][0]&&n>l[0]);if(r===-1)return n<=e[0][0]?e[0][1]:e[e.length-1][1];let a=t[r],[o]=e[r],[i]=e[r+1];return a((n-o)/(i-o))}};import*as We from"d3";import*as _e from"d3fc";function Ce(){let e=null;function t(n){let r=O(n,"div.legend-container",()=>n.append("div").attr("class","legend-container legend-color").style("z-index","2")),{width:a,height:o}=r.node().getBoundingClientRect(),i=We.scaleBand().domain([0,1]).range([0,a]),l=e.copy().nice().domain(),s=_e.extentLinear().pad([.1,.1]).padUnit("percent")(l),[c,u]=s,d=We.range(c,u,(u-c)/o),m=We.scaleLinear().domain(s).range([o,0]),p=_e.autoBandwidth(_e.seriesSvgBar()).xScale(i).yScale(m).crossValue(0).baseValue((v,V)=>d[Math.max(0,V-1)]).mainValue(v=>v).decorate(v=>{v.selectAll("path").style("fill",V=>e(V))}),f=l[0]<0&&l[1]>0?0:Math.round((l[1]+l[0])/2),h=[...l,f],y=mt(c,u),g=_e.axisRight(m).tickValues(h).tickSizeOuter(0).tickFormat(v=>y(v)),x=O(r,"svg",()=>r.append("svg")).style("width",a).style("height",o),b=O(x,"g",()=>x.append("g")).datum(d).call(p),S=Math.abs(b.node().getBBox().x);O(x,"#legend-axis",()=>x.append("g").attr("id","legend-axis")).attr("transform",`translate(${S})`).datum(d).call(g).select(".domain").attr("visibility","hidden")}return t.scale=(...n)=>n.length?(e=n[0],t):e,t}function Ye(){let e="element-prefix-unset",t=null,n=null,r=null,a=null,o=null,i=null,l=!0,s=null,c=u=>{let d=O(u,"div.outer-container",()=>u.append("div").attr("class","outer-container").style("width",`calc(100% - ${s??0})`).style("height",`calc(100% - ${s??0})`).style("padding-left",s??0)),m=O(d,"div.inner-container",()=>d.append("div").attr("class","inner-container")),p=d.node().getBoundingClientRect(),f=p.height,h=p.width-(o?70:0),y=300,g=u.datum(),x=Math.max(1,Math.min(g.length,Math.floor(h/y))),b=Math.ceil(g.length/x);i={width:h/Math.max(x,1),height:Math.min(f,Math.max(f/b,h/Math.max(x,1)))},f/b>i.height*.75&&(i.height=f/b),g.length>1?(m.style("grid-template-columns",`repeat(${x}, ${100/x}%)`),m.style("grid-template-rows",`repeat(${b}, ${i.height}px)`)):(m.style("grid-template-columns","repeat(1, 100%)"),m.style("grid-template-rows","repeat(1, 100%)")),r=m.selectAll(`div.${e}-container`).data(g,S=>S.split),r.exit().remove(),n=r.enter().append("div").attr("class",`${e}-container`),a=n.append("div").attr("class","title-container").style("text-align","center").attr("display","inline-block").append("text").attr("class","title").style("text-align","left"),l?t=n.append("svg").append("g").attr("class",e):t=n.append("div").attr("class",e)};return c.padding=(...u)=>u.length?(s=u[0],c):s,c.svg=(...u)=>u.length?(l=u[0],c):l,c.elementsPrefix=(...u)=>u.length?(e=u[0],c):e,c.chartContainer=()=>t,c.chartEnter=()=>n,c.chartDiv=()=>r,c.chartTitle=()=>a,c.containerSize=()=>i,c}import*as Ur from"d3fc";function Ho([e,t],[n,r]){let a=(r-t)/(n-e),o=r-a*n;return function(i){let l=i.node(),s=Math.min(l.clientWidth,l.clientHeight);return Math.min(r,Math.max(t,a*s+o))}}function Ct(){let e=null,t=null,n=null,r=null,a=o=>{let l=!!e.realValues[2],s=e.realValues[4],c=e.realValues[3]?Wr(e,t,"size").range([10,1e4]):null,u=e.realValues[5],d=Ho([600,.1],[1600,1])(o),m=Ur.seriesCanvasMulti().mapping((v,V)=>v[V]).series(t.map(()=>Ar(e,s,c,n,u,r,d))),p=()=>A(e).settingName("mainValues").paddingStrategy(H()).pad([.1,.1]),f=p().settingValue(e.mainValues[0].name).memoValue(e.axisMemo[0]).valueName("x")(t),h=p().orient("vertical").settingValue(e.mainValues[1].name).memoValue(e.axisMemo[1]).valueName("y")(t),[y,g]=e.splitValues.length===0?[e.mainValues[0].name,e.mainValues[1].name]:["",""],x=He(f,h).xLabel(y).yLabel(g).plotArea(z(m,e).canvas(!0));x.xNice&&x.xNice(),x.yNice&&x.yNice();let b=P().chart(x).settings(e).xScale(f.scale).yScale(h.scale).canvas(!0),S=W().scaleFactor(d).settings(e).canvas(!0).xScale(f.scale).xValueName("x").yValueName("y").yScale(h.scale).color(!l&&n).size(c).data(t);o.datum(t).call(b),o.call(S)};return a.settings=(...o)=>o.length?(e=o[0],a):e,a.data=(...o)=>o.length?(t=o[0],a):t,a.color=(...o)=>o.length?(n=o[0],a):n,a.symbols=(...o)=>o.length?(r=o[0],a):r,a}function Bo(e,t){if(!t)return;let n=e.realValues[4],r=e.mainValues.find(s=>s.name===n)?.type,a=t.domain(),o=t.range(),i=o.length;for(let[s,c]of a.entries())o[s]=o[s%i];let l=e.columns_config?.[n]?.symbols??{};return Object.entries(l).forEach(([s,c])=>{let u=sn[c]??nt.symbolCircle,d=a.findIndex(m=>{switch(r){case"date":case"datetime":return new Date(m).valueOf()===new Date(s).valueOf();default:return String(m)===String(s)}});o[d]=u}),t.range(o),t}function At(e,t){let n=t.realValues[2],r=!!n,a=t.mainValues.find(d=>d.name===n)?.type==="string",o=null,i=null,l=t.realValues[4],s=Tr(t,l),c=Bo(t,s),u=jr(t,Ie(t));if(r&&a?l?(t.splitValues.length>0?o=Te(t,u):o=Te(t,u[0]),i=Qe().settings(t).scale(c)):(o=In(t,n),i=R().settings(t).scale(o)):r?(o=Ve(t,u,"colorValue"),i=Ce().scale(o)):(o=Z().settings(t).domain([""])(),i=Qe().settings(t).scale(c)),t.splitValues.length!==0){let d=Ye().svg(!1).elementsPrefix("xy-scatter");d=d.padding("2.5em"),e.append("div").attr("class","multi-xlabel").append("p").text(t.mainValues[0].name),e.append("div").attr("class","multi-ylabel").append("p").text(t.mainValues[1].name).style("transform","rotate(-90deg)").style("text-wrap","nowrap"),e=e.datum(u),e.call(d);let f=d.chartContainer(),h=d.chartEnter(),y=d.chartDiv(),g=d.chartTitle(),x=d.containerSize();g.each((b,S,v)=>nt.select(v[S]).text(b.key)),h.merge(y).attr("transform",`translate(${x.width/2}, ${x.height/2})`).each(function(b){let S=nt.select(this);Ct().settings(t).data([b]).color(o).symbols(c)(S)})}else Ct().settings(t).data(u).color(o).symbols(c)(e);i&&e.call(i)}At.plugin={name:"X/Y Scatter",category:"X/Y Chart",max_cells:5e4,max_columns:50,render_warning:!0,initial:{type:"number",count:2,names:["X Axis","Y Axis","Color","Size","Symbol","Label","Tooltip"]},selectMode:"toggle"};At.can_render_column_styles=(e,t)=>e==="string"&&t==="Symbol";At.column_style_controls=(e,t)=>e==="string"&&t==="Symbol"?{symbols:{keys:"row",values:Object.keys(sn)}}:null;var Kr=At;import*as Tt from"d3fc";function Xr(e,t){let n=Tt.seriesCanvasHeatmap();return n.decorate((r,a)=>{r.fillStyle=t(a.colorValue)}),Tt.autoBandwidth(n).xValue(r=>r.crossValue).yValue(r=>r.mainValue).colorValue(r=>r.colorValue).colorInterpolate(t.interpolator()).widthFraction(1)}function qr(e,t){let n=U(e),r=Ee(e).excludeType(C.linear).settingName("splitValues")(),a=[];return t.forEach((o,i)=>{let l=n(o,i);Object.keys(o).filter(s=>s!=="__ROW_PATH__").forEach(s=>{let c=Io(s);a.push({crossValue:l,mainValue:r===C.time?new Date(c):c,colorValue:o[s],row:o})})}),a}function Io(e){let t=e.split("|");return t.pop(),t.join("|")}function Zr(e,t){let n=qr(t,K(t)),r=Ve(t,n,"colorValue"),a=Xr(t,r),o=Ce().scale(r),i=A(t).excludeType(C.linear).settingName("crossValues").valueName("crossValue")(n),l=A(t).excludeType(C.linear).settingName("splitValues").valueName("mainValue").modifyDomain(d=>!isNaN(d[0])?d.reverse():d).orient("vertical")(n),s=He(i,l).plotArea(z(a,t).canvas(!0));s.xPaddingInner&&(s.xPaddingInner(0),s.xPaddingOuter(0),a.xAlign("right")),s.yPaddingInner&&(s.yPaddingInner(0),s.yPaddingOuter(0),a.yAlign("top"));let c=P().chart(s).settings(t).xScale(i.scale).yScale(l.scale).canvas(!0),u=W().settings(t).canvas(!0).xScale(i.scale).yScale(l.scale).color(r).data(n);e.datum(n).call(c),e.call(o),e.call(u)}Zr.plugin={name:"Heatmap",category:"Hierarchial Chart",max_cells:5e4,max_columns:500,render_warning:!0,initial:{names:["Color"]}};var Jr=Zr;import{seriesCanvasOhlc as Wo}from"d3fc";import*as Dt from"d3fc";function Qr(e,t){return ke(e,t,{excludeEmpty:!0}).map(n=>$o(e,n))}function $o(e,t){let n=U(e),r=o=>t[o<t.length-1?o+1:o][e.realValues[0]],a=t.map((o,i)=>{let l=e.realValues[0]?o[e.realValues[0]]:void 0,s=e.realValues[1]?o[e.realValues[1]]:r(i);return{crossValue:n(o,i),mainValues:e.mainValues.map(c=>o[c.name]),openValue:l,closeValue:s,highValue:e.realValues[2]?o[e.realValues[2]]:Math.max(l,s),lowValue:e.realValues[3]?o[e.realValues[3]]:Math.min(l,s),key:t.key,row:o}});return a.key=t.key,a}import*as Ue from"d3fc";var Go=e=>e.closeValue>=e.openValue;function ea(e,t,n){let r=n.domain(),a=Z().domain(r).settings(e).defaultColors([e.colorStyles["series-2"]]).mapFunction(Le(.5))(),o=Z().settings(e).domain(r)(),i=t().crossValue(c=>c.crossValue).openValue(c=>c.openValue).highValue(c=>c.highValue).lowValue(c=>c.lowValue).closeValue(c=>c.closeValue).decorate((c,u)=>{let d=Go(u)?n(u.key):a(u.key);c.fillStyle=d,c.strokeStyle=d}),l=Ue.seriesCanvasLine().mainValue(c=>c.bollinger.average).crossValue(c=>c.crossValue).decorate((c,u)=>{c.strokeStyle=o(u[0].key)}),s=Ue.seriesCanvasArea().mainValue(c=>c.bollinger.upper).baseValue(c=>c.bollinger.lower).crossValue(c=>c.crossValue).decorate((c,u)=>{c.fillStyle=Le(.25)(o(u[0].key))});return Ue.seriesCanvasMulti().series([s,i,l])}function jo(e){return function(t,n){let r=Qr(n,Ie(n)),a=Dt.indicatorBollingerBands().value(g=>g.openValue),o=r.map(g=>{let x=a(g);return g.map((b,S)=>Object.assign({bollinger:x[S]},b))}),i=r.map(g=>g.key).concat(n.hideKeys?n.hideKeys:[]).sort(),l=Z().domain(i).settings(n).mapFunction(Le(1))(),s=R().settings(n).scale(i.length>1?l:null),c=ea(n,e,l),u=Dt.seriesCanvasMulti().mapping((g,x)=>g[x]).series(o.map(()=>c)),d=H().pad([.1,.1]).padUnit("percent"),m=A(n).settingName("crossValues").valueName("crossValue")(o),p=A(n).settingName("mainValues").valueNames(["lowValue","highValue"]).memoValue(n.axisMemo[1]).orient("vertical").paddingStrategy(d)(o),f=He(m,p).plotArea(z(u,n).orient("vertical").canvas(!0));f.yNice&&f.yNice();let h=P().chart(f).settings(n).xScale(m.scale).onChange(g=>{let x=o.map(b=>b.filter(S=>S.crossValue>=g.xDomain[0]&&S.crossValue<=g.xDomain[1]));f.yDomain(p.domainFunction(x))}).canvas(!0),y=W().settings(n).xScale(m.scale).yScale(p.scale).yValueName("closeValue").color(l).data(o).canvas(!0);t.datum(o).call(h),t.call(y),t.call(s)}}var Lt=jo;var ta=Lt(Wo);ta.plugin={name:"OHLC",category:"Y Chart",max_cells:3500,max_columns:50,render_warning:!0,initial:{type:"number",count:1,names:["Open","Close","High","Low","Tooltip"]},selectMode:"toggle"};var na=ta;import{seriesCanvasCandlestick as Yo}from"d3fc";var ra=Lt(Yo);ra.plugin={name:"Candlestick",category:"Y Chart",max_cells:4e3,max_columns:50,render_warning:!0,initial:{type:"number",count:1,names:["Open","Close","High","Low","Tooltip"]},selectMode:"toggle"};var aa=ra;import*as cn from"d3";function oa(e,t){if(e.realValues.length>1&&e.realValues[1]!==null){let n=e.realValues[1];if(e.mainValues.find(r=>r.name===n)?.type==="string"){let r=t.map(a=>a.data).filter(a=>a.height>0).map(a=>ia(a)).reduce((a,o)=>a.concat(o));return Te(e,r)}else return Ve(e,null,null,bn(t.map(r=>r.extents)))}}function ia(e,t=[]){return e.children&&e.children.length>0?e.children.forEach(n=>t.concat(ia(n,t))):e.data.color&&t.push(e.data.color),t}import*as kt from"d3";function Nt(e){let t={},n=e.realValues.map(a=>a===null?null:e.mainValues.find(o=>o.name===a));return e.data.forEach((a,o)=>{let i=Array.isArray(a.__ROW_PATH__)?a.__ROW_PATH__:[];Ko(a).forEach(s=>{let c;t[s]||(t[s]=[]),c=t[s],i.forEach((u,d)=>{let m=c.find(p=>p.name===u);if(m||(m={name:u,children:[]},c.push(m)),e.realValues.length>1&&e.realValues[1]!==null){let p=d===i.length-1,f=Ke(p?a:e.agg_paths[o][d+1]||a,e.mainValues[1],s);f!==void 0&&(m.color=f)}if(e.realValues.length>2&&e.realValues[2]!==null){m.tooltip=[];for(let p=2;p<e.realValues.length;++p)m.tooltip.push(Ke(a,n[p],s))}if(d===i.length-1){if(m.name=i.slice(-1)[0],e.crossValues.length===0)m.size=Ke(a,e.mainValues[0],"");else if(i.length===e.crossValues.length){let p=Ke(a,e.mainValues[0],s);m.size=p>0?p:0}}c=m.children})})}),Object.entries(t).map(a=>{let o={name:"root",children:a[1]},i=kt.hierarchy(o).sum(s=>s.size),l=kt.partition().size([2*Math.PI,i.height+1])(i);return l.each(s=>{s.current=s,s.mainValues=e.realValues.length===1||e.realValues[1]===null&&e.realValues[2]===null?s.value:[s.value,s.data.color].concat(s.data.tooltip||[]).filter(c=>c!==void 0),s.crossValue=s.ancestors().slice(0,-1).reverse().map(c=>c.data.name),s.key=a[0],s.label=se(e.crossValues[s.depth-1<0?0:s.depth-1]?.type||e.mainValues[0].type,s.data.name)}),{split:a[0],data:l,extents:Uo(e,a)}})}var Ke=(e,t,n)=>n.length?e[`${n}|${t.name}`]:e[t.name];function Uo(e,[t,n]){if(e.realValues.length>1&&e.realValues[1]!==null){let r=Math.min(...e.data.map(o=>Ke(o,e.mainValues[1],t))),a=Math.max(...n.map(o=>o.color));return[r,a]}}function Ko(e){let t=[];return Object.keys(e).forEach(n=>{if(n!=="__ROW_PATH__"){let r=n.split("|").slice(0,-1).join("|");t.includes(r)||t.push(r)}}),t}import{arc as Xo}from"d3";var Mt=e=>Xo().startAngle(t=>t.x0).endAngle(t=>t.x1).padAngle(t=>Math.min((t.x1-t.x0)/2,.005)).padRadius(e).innerRadius(t=>Math.max(1,(t.y0-1)*e)).outerRadius(t=>Math.max((t.y0-1)*e,(t.y1-1)*e-1)),ue=e=>e.y0>=1&&e.x1>e.x0;import{select as qo}from"d3";var rt=e=>e.y1<=3&&e.y0>=1&&(e.y1-e.y0)*(e.x1-e.x0)>.06;function Ot(e,t){let n=(e.x0+e.x1)/2*180/Math.PI,r=(e.y0-1+(e.y1-1))/2*t;return`rotate(${n-90}) translate(${r},0) rotate(${n<180?0:180})`}function la(e,t){let n=this.getBBox().width;if(n>t){let r=e.label,a=qo(this);for(;n>t;)r=r.substring(0,r.length-1),a.text(()=>r),n=this.getBBox().width;a.text(()=>`${r.substring(0,r.length-3).replace(/\s+$/,"")}...`)}}import{interpolate as Zo}from"d3";var sa=(e,t,n,r,a,o,i,l,s)=>(c,u)=>{s.sunburstLevel[l]=c.data.name,c.parent?(n.datum(c.parent),n.style("cursor","pointer"),r.html(`&#8682; ${c.label}`)):(n.datum(e),n.style("cursor","default"),r.html("")),e.each(m=>m.target={x0:Math.max(0,Math.min(1,(m.x0-c.x0)/(c.x1-c.x0)))*2*Math.PI,x1:Math.max(0,Math.min(1,(m.x1-c.x0)/(c.x1-c.x0)))*2*Math.PI,y0:Math.max(0,m.y0-c.depth),y1:Math.max(0,m.y1-c.depth)});let d=t.transition().duration(u?0:750);a.transition(d).tween("data",m=>{let p=Zo(m.current,m.target);return f=>m.current=p(f)}).filter(function(m){return+this.getAttribute("fill-opacity")||ue(m.target)}).attr("fill-opacity",m=>ue(m.target)?1:0).attr("user-select",m=>ue(m.target)?"initial":"none").style("pointer-events",m=>ue(m.target)?"initial":"none").attrTween("d",m=>()=>Mt(i)(m.current)),o.filter(function(m){return+this.getAttribute("fill-opacity")||rt(m.target)}).transition(d).attr("fill-opacity",m=>+rt(m.target)).attrTween("transform",m=>()=>Ot(m.current,i))};function ca(){let e=null,t=null,n=null,r=null,a=null,o=i=>{let l=i.selectAll("g.segment").data(n.descendants().slice(1)),s=l.enter().append("g").attr("class","segment");s.append("path"),s.append("text").attr("class","segment").attr("dy","0.35em");let c=s.merge(l),u=c.select("path").attr("fill-opacity",h=>ue(h.current)?1:0).attr("user-select",h=>ue(h.current)?"initial":"none").style("pointer-events",h=>ue(h.current)?"initial":"none").attr("d",h=>Mt(a)(h.current));r&&u.style("fill",h=>r(h.data.color));let d=c.select("text").attr("fill-opacity",h=>+rt(h.current)).attr("transform",h=>Ot(h.current,a)).text(h=>h.label).each(function(h){la.call(this,h,a)}),m=i.select("text.parent"),p=i.select("circle").attr("r",a).datum(n),f=sa(n,i,p,m,u,d,a,t,e);if(e.sunburstLevel){let h=n.descendants().find(y=>y.data.name===e.sunburstLevel[t]);h&&f(h,!0)}else e.sunburstLevel={};p.on("click",h=>f(h,!1)),u.filter(h=>h.children).style("cursor","pointer").on("click",h=>f(h,!1))};return o.settings=(...i)=>i.length?(e=i[0],o):e,o.split=(...i)=>i.length?(t=i[0],o):t,o.data=(...i)=>i.length?(n=i[0],o):n,o.color=(...i)=>i.length?(r=i[0],o):r,o.radius=(...i)=>i.length?(a=i[0],o):a,o}function ua(e,t){let n=Nt(t),r=oa(t,n),a=Ye().elementsPrefix("sunburst");if(e.datum(n).call(a),r){let u=t.realValues[1];if(t.mainValues.find(d=>d.name===u)?.type==="string"){let d=R().settings(t).scale(r);e.call(d)}else{let d=Ce().scale(r);e.call(d)}}let o=a.chartContainer(),i=a.chartEnter(),l=a.chartDiv(),s=a.chartTitle(),c=a.containerSize();s.each((u,d,m)=>cn.select(m[d]).text(u.split)),o.append("circle").attr("fill","none").style("pointer-events","all"),o.append("text").attr("class","parent"),i.merge(l).select("svg").select("g.sunburst").attr("transform",`translate(${c.width/2}, ${c.height/2})`).each(function({split:u,data:d}){let m=cn.select(this),p=this.parentNode,{width:f,height:h}=p.getBoundingClientRect(),y=(Math.min(f,h)-24)/Math.max(2,t.crossValues.length*2);ca().settings(t).split(u).data(d).color(r).radius(y)(m),ye().settings(t)(m.selectAll("g.segment"))})}ua.plugin={name:"Sunburst",category:"Hierarchial Chart",max_cells:7500,max_columns:50,render_warning:!0,initial:{type:"number",count:1,names:["Size","Color","Tooltip"]}};var ma=ua;import*as it from"d3";function pa(e,t){if(e.realValues.length<1||e.realValues[1]===null||e.realValues[1]===void 0)return;let n=e.realValues[1],r=t.filter(a=>a.height>0).map(a=>da(a)).reduce((a,o)=>a.concat(o));if(e.mainValues.find(a=>a.name===n)?.type==="string")return Te(e,r);{let a=Math.min(...r),o=Math.max(...r);return Ve(e,null,null,[a,o])}}function da(e,t=[]){return e.children&&e.children.length>0?e.children.forEach(n=>t.concat(da(n,t))):e.data.color&&t.push(e.data.color),t}import{select as B}from"d3";var fa=7,zt=e=>!!(e.target&&e.target.textAttributes),Pt=(e,t,n)=>{e.selectAll("text").each(function(a,o){let i=ti(a,t,n);this.style=i});let r=ot(e);Jo(r),un(r)},ha=e=>{e.each((t,n,r)=>{B(r[n]).selectAll("text").attr("dx",t.target.textAttributes.dx).attr("dy",t.target.textAttributes.dy).attr("style",t.target.textAttributes.style)})},un=e=>{let r=o=>o.getBoundingClientRect(),a=[];e.selectAll("text").filter((o,i,l)=>B(l[i]).attr("style")===Oe.high).each((o,i,l)=>a.push(l[i])),e.selectAll("text").filter((o,i,l)=>B(l[i]).attr("style")===Oe.low).each((o,i,l)=>{let s=l[i];a.filter(c=>Zt("x",r(c),r(s))&&Zt("y",r(c),r(s),-2)).forEach(()=>B(s).attr("dy",Number(B(s).attr("dy"))+14))})},ga=e=>B(e).style("opacity",at[B(e).attr("class")]),ya=e=>B(e).style("opacity",null),at={top:1,mid:.7,lower:0},ot=e=>e.filter((t,n,r)=>B(r[n]).selectAll("text").attr("style")!==Oe.zero),Et=e=>e.selectAll("text").each((t,n,r)=>Qo(r[n])),Jo=e=>e.selectAll("text").each((t,n,r)=>xa(r[n])),xa=e=>{let t=B(e),n=e.getBoundingClientRect();t.attr("dx",0-n.width/2).attr("dy",0+n.height/4)},Qo=e=>{let n=e.parentNode.childNodes[0],r=e.getBBox(),a=n.getBBox();ei(e,a,r)||B(e).attr("style",B(e).attr("style"))},ei=(e,t,n)=>{let r=Math.min(t.height/n.height,t.width/n.width);if(r<1){let a=parseInt(B(e).style("font-size")),o=Math.floor(a*r);return a>fa&&o>fa?(B(e).style("font-size",`${o}px`),xa(e)):(B(e).style("font-size",null),B(e).style("opacity","0")),!0}return!1},ti=(e,t,n)=>{if(!n.filter(r=>r!=="").every(r=>e.crossValue.includes(r)))return Oe.zero;switch(e.depth){case t+1:return Oe.high;case t+2:return Oe.low;default:return Oe.zero}},Oe={high:"font-size:14px;z-index:5;pointer-events: none;",low:"font-size:8px;opacity:0.7;z-index:4;",zero:"font-size:0px;opacity:0;z-index:4;"};import*as Ft from"d3";var Rt=(e,t)=>{let n=Ft.treemap().size([e,t]).paddingInner(r=>1+2*(r.height-1));return n.tile(Ft.treemapBinary),n};import*as ae from"d3";import{hierarchy as ni,select as mn}from"d3";var ri=(e,t)=>t.every(n=>e.crossValue.includes(n));function pn(e,t,n,r,a,o){ai(e,t,n,r,a),e.mapLevel[r].levelRoot=!0,oi(e,o.node().getBoundingClientRect().width,o.node().getBoundingClientRect().height,r),ba(n,r)}function Sa(e,t){e.each(n=>{n.mapLevel=[],n.mapLevel[0]={x0:n.x0,x1:ze(n)+n.x0,y0:n.y0,y1:Pe(n)+n.y0,visible:!0,opacity:1}}),t.mapLevel[0].levelRoot=!0,ba(e,0)}var Ht=(e,t)=>{e.each((n,r,a)=>{let o=mn(a[r]).selectAll("text");n.mapLevel[t].textAttributes={dx:o.attr("dx"),dy:o.attr("dy"),class:o.attr("class"),"font-size":o.style("font-size")}})};function ai(e,t,n,r,a){let o={x:e.x0,y:e.y0,width:e.x1-e.x0,height:e.y1-e.y0},i={width:a.x1-a.x0,height:a.y1-a.y0},l={width:i.width/o.width,height:i.height/o.height};n.each(s=>{let c=(s.x0-o.x)*l.width,u=(s.y0-o.y)*l.height,d=ze(s)*l.width,m=Pe(s)*l.height,p=ri(s,t)&&s.data.name!==t[r-1];s.mapLevel[r]={x0:c,x1:d+c,y0:u,y1:m+u,visible:p,opacity:p?1:0}}),e.mapLevel[r].levelRoot=!0}function oi(e,t,n,r){let i=Rt(t,n)(ni(e.data).sum(s=>s.size)).descendants(),l=e.descendants();i.forEach((s,c)=>{l[c].mapLevel[r].x0=i[c].x0,l[c].mapLevel[r].x1=i[c].x1,l[c].mapLevel[r].y0=i[c].y0,l[c].mapLevel[r].y1=i[c].y1})}function ba(e,t){e.selectAll("text").each((n,r,a)=>{let o=mn(a[r]),i=mn(a[r]).datum(),l=o.attr("class");i.mapLevel[t].textLockedAt={opacity:at[l]}})}function va(e,t,n,r,a,o,i,l,s){if(r.treemapLevel>0){let c=i.crossValue;fn(i,e,t,n,r,a,o,i,0,c,l,s,1,!1),r.treemapRoute.slice(1,r.treemapRoute.length).forEach(u=>{let d=t.filter(p=>p.crossValue===u).datum(),m=d.crossValue;pn(d,m,t,d.depth,i,a),fn(d,e,t,n,r,a,o,i,d.depth,m,l,s,1,!1)})}}function hn(e,t,n,r,a,o,i,l,s,c){if(!e.children)return;a.treemapLevel<e.depth?a.treemapRoute.push(e.crossValue):a.treemapRoute.pop(),a.treemapLevel=e.depth;let u=e.crossValue;(!e.mapLevel[a.treemapLevel]||!e.mapLevel[a.treemapLevel].levelRoot)&&pn(e,u,n,a.treemapLevel,l,o),fn(e,t,n,r,a,o,i,l,a.treemapLevel,u,s,c)}function fn(e,t,n,r,a,o,i,l,s,c,u,d,m=500,p=!0){let f=e.parent,h=i.transition("main transition").duration(m).ease(ae.easeCubicOut);n.each(g=>g.target=g.mapLevel[s]),zt(e)||ci(n,u),n.transition(h).tween("data",g=>{let x=ae.interpolate(g.current,g.target);return b=>g.current=x(b)}).styleTween("opacity",g=>()=>g.current.opacity).attrTween("pointer-events",g=>()=>g.target.visible?"all":"none"),t.transition(h).filter(g=>g.target.visible).styleTween("x",g=>()=>`${g.current.x0}px`).styleTween("y",g=>()=>`${g.current.y0}px`).styleTween("width",g=>()=>`${g.current.x1-g.current.x0}px`).styleTween("height",g=>()=>`${g.current.y1-g.current.y0}px`),r.transition(h).filter(g=>g.target.visible).attrTween("x",g=>()=>g.current.x0+ze(g.current)/2).attrTween("y",g=>()=>g.current.y0+Pe(g.current)/2).end().catch(()=>dn(n)).then(()=>{zt(e)||(un(y),Et(y),ii(r,i,m),p&&Ht(n,s),dn(n,u))}).catch(g=>{console.error("Exception completing promises after main transition",g),dn(n,u)}),zt(e)?ha(n):(r.each((g,x,b)=>ga(b[x])),Pt(n,s,c));let y=ot(n);f?u.hide(!1).text(e.label).onClick(()=>{hn(f,t,n,r,a,o,i,l,u,d);let g=o.node().getRootNode().host.parentElement;Ze(g,f,d)})():u.hide(!0)()}async function ii(e,t,n=400){let r=t.transition("text fade transition").duration(n).ease(ae.easeCubicOut);await e.transition(r).filter(a=>a.target.visible).tween("data",(a,o,i)=>{let l=i[o],s=ae.interpolate(li(a),si(l));return c=>a.current.opacity=s(c)}).styleTween("opacity",a=>()=>a.current.opacity).end().catch(a=>console.error("Exception in text fade transition",a)).then(()=>e.each((a,o,i)=>ya(i[o])))}var li=e=>e.target.textLockedAt.opacity,si=e=>at[ae.select(e).attr("class")],ci=(e,t)=>{t.deactivate(!0),e.each((n,r,a)=>{ae.select(a[r]).selectAll("rect").style("pointer-events","none")})},dn=(e,t=void 0)=>{t&&t.deactivate(!1),e.each((n,r,a)=>{ae.select(a[r]).selectAll("rect").style("pointer-events",null)})};var wa=`<button id="goto-parent">Goto parent</button>
`;function Va(e){let t=null,n=null,r=!0,a=!1,o=O(e,".parent-controls",()=>e.append("div").attr("class","parent-controls").style("display",r?"none":"").html(wa)),i=()=>{o.style("display",r?"none":"").select("#goto-parent").style("pointer-events",a?"none":null).html(`\u21EA ${n}`).on("click",()=>t())};return i.deactivate=(...l)=>{if(!l.length)return a;a=l[0];let s=o.select("#goto-parent");return a?s.style("pointer-events","none"):s.style("pointer-events",null),i},i.hide=(...l)=>l.length?(r=l[0],i):r,i.text=(...l)=>l.length?(n=l[0],i):n,i.onClick=(...l)=>l.length?(t=l[0],i):t,i}var Bt={leaf:"leafnode",branch:"branchnode",root:"rootnode"},ze=e=>e.x1-e.x0,Pe=e=>e.y1-e.y0,mi=(e,t)=>t.depth===e,_a=(e,t)=>t.depth===0?Bt.root:mi(e,t)?Bt.leaf:Bt.branch;function Ca(){let e=null,t=null,n=null,r=null,a=null,o=null,i=l=>{o=Va(a),o();let s=n.height;e.treemapLevel||(e.treemapLevel=0),e.treemapRoute||(e.treemapRoute=[]),Rt(a.node().getBoundingClientRect().width,a.node().getBoundingClientRect().height)(n);let u=l.selectAll("g").data(n.descendants()),d=u.enter().append("g");d.append("rect"),d.append("text");let m=d.merge(u).sort((y,g)=>g.depth-y.depth),p=m.select("rect").attr("class",y=>`treerect ${_a(s,y)}`).style("x",y=>y.x0).style("y",y=>y.y0).style("width",y=>ze(y)).style("height",y=>Pe(y));p.style("fill",y=>_a(s,y)===Bt.leaf?y.data.color?r(y.data.color):t.colorStyles.series:"transparent");let f=m.filter(y=>y.value!==0).select("text").attr("x",y=>y.x0+ze(y)/2).attr("y",y=>y.y0+Pe(y)/2).text(y=>y.label),h=p.filter(y=>y.crossValue.length===0).datum();Sa(m,h),Pt(m,0,[]),Et(ot(m)),Ht(m,0),e.treemapRoute.length===0&&e.treemapRoute.push(h.crossValue),p.filter(y=>y.children).on("click",(y,g)=>hn(g,p,m,f,e,a,l,h,o,t)),va(p,m,f,e,a,l,h,o,t)};return i.settings=(...l)=>l.length?(e=l[0],t=l[1],i):e,i.data=(...l)=>l.length?(n=l[0],i):n,i.color=(...l)=>l.length?(r=l[0],i):r,i.container=(...l)=>l.length?(a=l[0],i):a,i}function Aa(e,t){t.treemaps||(t.treemaps={});let n=Nt(t),r=pa(t,n.map(s=>s.data));r&&this._container.classList.add("has-legend");let a=Ye().elementsPrefix("treemap");if(e.datum(n).call(a),r){let s=t.realValues[1];if(t.mainValues.find(c=>c.name===s)?.type==="string"){let c=R().settings(t).scale(r);e.call(c)}else{let c=Ce().scale(r);e.call(c)}}let o=a.chartEnter(),i=a.chartDiv();a.chartTitle().each((s,c,u)=>it.select(u[c]).text(s.split)),o.merge(i).select("svg").select("g.treemap").each(function({split:s,data:c}){let u=it.select(this);t.treemaps[s]||(t.treemaps[s]={}),Ca().settings(t.treemaps[s],t).data(c).container(it.select(it.select(this.parentNode).node().parentNode)).color(r)(u),ye().settings(t).centered(!0)(u.selectAll("g"))})}Aa.plugin={type:"Treemap",name:"Treemap",category:"Hierarchial Chart",max_cells:3e3,max_columns:50,render_warning:!0,initial:{type:"number",count:1,names:["Size","Color","Tooltip"]}};var Ta=Aa;var pi=[ur,br,Cr,Mr,Fr,Gr,Kr,na,aa,Ta,ma,Jr],gn=pi;import*as yn from"d3";import*as Da from"gradient-parser";var xn=(e,t)=>{if(!t.colorStyles){let n={scheme:[],gradient:{},interpolator:{},grid:{}},r=hi(e);n.series=r("--d3fc-local-series");for(let o=1;;o++){let i=`series-${o}`,l=r(`--d3fc-local-${i}`);if(!l)break;n[i]=l,n.scheme.push(l)}n.opacity=di(n.series),n.grid.gridLineColor=r`--d3fc-gridline--color`,["full","positive","negative"].forEach(o=>{let i=r(`--d3fc-local-${o}--gradient`);n.gradient[o]=gi(i,n.opacity)}),t.colorStyles=n}if(!t.textStyles){let n=window.getComputedStyle(e),r=n.getPropertyValue("color"),a=`12px ${n.getPropertyValue("font-family")}`;t.textStyles={color:r,font:a}}},di=e=>yn.color(e).opacity,fi=(e,t)=>{let n=yn.color(`#${e}`);return n.opacity=t,n+""},hi=e=>{let t=getComputedStyle(e);return n=>t?.getPropertyValue(n)},gi=(e,t)=>{let n=Da.parse(e)[0].colorStops;return n.map((r,a)=>[r.length?r.length.value/100:a/(n.length-1),fi(r.value,t)]).sort((r,a)=>r[0]-a[0])};var La=':host .chart{--d3fc-local-full--gradient:var(--d3fc-full--gradient,linear-gradient(#4d342f 0%,#e4521b 22.5%,#feeb65 42.5%,#f0f0f0 50%,#dcedc8 57.5%,#42b3d5 67.5%,#1a237e 100%));--d3fc-local-positive--gradient:var(--d3fc-positive--gradient,linear-gradient(#dcedc8 0%,#42b3d5 35%,#1a237e 100%));--d3fc-local-negative--gradient:var(--d3fc-negative--gradient,linear-gradient(#feeb65 100%,#e4521b 70%,#4d342f 0%));--d3fc-local-series:var(--d3fc-series,rgba(31,119,180,0.5));--d3fc-local-series-1:var(--d3fc-series-1,#0366d6);--d3fc-local-series-2:var(--d3fc-series-2,#ff7f0e);--d3fc-local-series-3:var(--d3fc-series-3,#2ca02c);--d3fc-local-series-4:var(--d3fc-series-4,#d62728);--d3fc-local-series-5:var(--d3fc-series-5,#9467bd);--d3fc-local-series-6:var(--d3fc-series-6,#8c564b);--d3fc-local-series-7:var(--d3fc-series-7,#e377c2);--d3fc-local-series-8:var(--d3fc-series-8,#7f7f7f);--d3fc-local-series-9:var(--d3fc-series-9,#bcbd22);--d3fc-local-series-10:var(--d3fc-series-10,#17becf);}:host .chart .series{fill:var(--d3fc-local-series);}:host .chart .series-1{fill:var(--d3fc-local-series-1);}:host .chart .series-2{fill:var(--d3fc-local-series-2);}:host .chart .series-3{fill:var(--d3fc-local-series-3);}:host .chart .series-4{fill:var(--d3fc-local-series-4);}:host .chart .series-5{fill:var(--d3fc-local-series-5);}:host .chart .series-6{fill:var(--d3fc-local-series-6);}:host .chart .series-7{fill:var(--d3fc-local-series-7);}:host .chart .series-8{fill:var(--d3fc-local-series-8);}:host .chart .series-9{fill:var(--d3fc-local-series-9);}:host .chart .series-10{fill:var(--d3fc-local-series-10);}:host{user-select:none;}:host .chart{position:absolute;box-sizing:border-box;left:0;top:0;width:100%;height:100%;padding:12px;overflow:hidden;}:host .chart.heatmap d3fc-group.cartesian-chart,:host .chart.treemap d3fc-group.cartesian-chart{grid-template-columns:minmax(0em,max-content)auto 1fr auto minmax(0em,max-content);grid-template-rows:minmax(0em,max-content)auto 1fr auto minmax(0em,max-content);}:host .chart .chart-label{display:none;}:host .chart.heatmap{padding-right:120px;}:host .chart.xyscatter{padding:0;font-size:14px;}:host .chart.xyscatter d3fc-group:first-child{padding:16px;padding-top:0px;width:calc(100% - 32px);height:calc(100% - 16px);}:host .chart.xyscatter .multi-xlabel{position:absolute;bottom:0;height:2.5em;width:100%;display:flex;justify-content:center;align-items:center;background:var(--d3fc-legend--background);}:host .chart.xyscatter .multi-ylabel{position:absolute;top:0;width:2.5em;height:100%;display:flex;justify-content:center;align-items:center;background:var(--d3fc-legend--background);}:host .chart.xyscatter .outer-container{height:100%;}:host .chart.xyscatter .inner-container{display:inline-grid;overflow-y:auto;width:calc(100% - 16px);height:100%;padding:0;margin:0;}:host .chart.xyscatter .inner-container div{overflow:hidden;}:host .chart.xyscatter .inner-container text.segment,:host .chart.xyscatter .inner-container text.parent{text-anchor:middle;user-select:none;pointer-events:none;fill:var(--d3fc-treedata--labels,rgb(51,51,51));}:host .chart.xyscatter .inner-container div.xy-scatter-container{margin:5px 0;}:host .chart.sunburst{padding:0;font-size:14px;}:host .chart.sunburst .outer-container{height:100%;}:host .chart.sunburst .inner-container{width:100%;height:100%;display:inline-grid;padding:0;margin:0;overflow-x:hidden;overflow-y:auto;}:host .chart.sunburst .inner-container div{overflow:hidden;}:host .chart.sunburst .inner-container .sunburst-container:not(:only-child) svg{transform:translate(0,-27px);}:host .chart.sunburst .inner-container svg{width:100%;height:100%;}:host .chart.sunburst .inner-container path{fill:var(--d3fc-series,rgba(31,119,180,0.5));}:host .chart.sunburst .inner-container text.segment,:host .chart.sunburst .inner-container text.parent{text-anchor:middle;user-select:none;pointer-events:none;fill:var(--d3fc-treedata--labels,rgb(51,51,51));}:host .chart.sunburst .inner-container div.title-container{margin-top:5px;}:host .chart.has-legend{padding-right:120px;}:host .chart.treemap .treemap-container{position:relative;}:host .chart.treemap .treemap-container:not(:only-child){width:calc(100% - 12px);height:calc(100% - 12px);}:host .chart.treemap .outer-container{height:100%;}:host .chart.treemap .inner-container{width:100%;height:100%;display:inline-grid;padding:0;margin:0;overflow-x:hidden;overflow-y:auto;}:host .chart.treemap .inner-container div{overflow:hidden;}:host .chart.treemap .inner-container svg{width:100%;height:100%;}:host .chart.treemap .inner-container .treerect{stroke:var(--d3fc-treedata-axis--lines,var(--d3fc-axis--lines,white));fill:var(--d3fc-series,rgba(31,119,180,0.5));}:host .chart.treemap .inner-container .treerect:hover{cursor:pointer;stroke:var(--d3fc-treedata--hover-highlight,black);stroke-opacity:1;}:host .chart.treemap .inner-container .rootnode{opacity:0;pointer-events:none;z-index:0;}:host .chart.treemap .inner-container .branchnode{opacity:0;}:host .chart.treemap .inner-container .branchnode:hover{fill-opacity:0.1;opacity:1;fill:var(--d3fc-treedata--hover-highlight,black);}:host .chart.treemap .inner-container .leafnode{fill-opacity:0.8;}:host .chart.treemap .inner-container .leafnode:hover{fill-opacity:0.5;}:host .chart.treemap .inner-container #hidden{opacity:0;pointer-events:none;z-index:0;}:host .chart.treemap .inner-container .top{font-size:14px;z-index:5;pointer-events:none;}:host .chart.treemap .inner-container .mid{font-size:8px;opacity:0.7;z-index:4;}:host .chart.treemap .inner-container .lower{font-size:0px;opacity:0;z-index:4;}:host .chart.treemap .inner-container text{fill:var(--d3fc-treedata--labels,rgb(51,51,51));}:host .chart.treemap .inner-container text.title{dominant-baseline:hanging;}:host .chart.treemap .inner-container .parent-controls{position:absolute;top:12px;right:auto;left:30px;width:auto;z-index:4;transition:box-shadow 1s;}:host .chart.treemap .inner-container .parent-controls:hover{box-shadow:2px 2px 6px#000;transition:box-shadow 0.2s;}:host .chart .x-label{height:1.2em!important;line-height:1em!important;}:host .chart .x-label,:host .chart .y-label{color:var(--d3fc-label--color,inherit);font-size:14px;}:host .chart d3fc-canvas.plot-area{display:none;}:host .chart.xyscatter d3fc-canvas.plot-area,:host .chart.xyline d3fc-canvas.plot-area,:host .chart.ohlc d3fc-canvas.plot-area,:host .chart.candlestick d3fc-canvas.plot-area,:host .chart.heatmap d3fc-canvas.plot-area{display:block;}:host .chart .y-axis text,:host .chart .x-axis text{fill:var(--d3fc-axis-ticks--color,rgb(80,80,80));font-size:11px;}:host .chart .y-axis path,:host .chart .x-axis path{stroke:var(--d3fc-axis--lines,rgb(180,210,225));}:host .chart .splitter-label{display:inline-block;margin:0 10px;cursor:pointer;}:host .chart .splitter-label::after{margin-left:5px;color:var(--d3fc-axis--lines,rgb(180,210,225));}:host .chart .splitter-label:hover::after{color:var(--d3fc-axis-ticks--color,rgb(80,80,80));}:host .chart .splitter-label.disabled::after{color:rgba(80,80,80,0.3);}:host .chart .splitter-label.disabled{cursor:default;}:host .chart .y-label.left-label .splitter-label::after{background-repeat:no-repeat;background-color:var(--icon--color);content:"";display:inline-block;-webkit-mask-size:cover;mask-size:cover;width:16px;height:12px;-webkit-mask-image:var(--sort-desc-icon--mask-image);mask-image:var(--sort-desc-icon--mask-image);}:host .chart .y-label.right-label .splitter-label::after{background-repeat:no-repeat;background-color:var(--icon--color);content:"";display:inline-block;-webkit-mask-size:cover;mask-size:cover;width:16px;height:12px;-webkit-mask-image:var(--sort-asc-icon--mask-image);mask-image:var(--sort-asc-icon--mask-image);}:host .chart.ybar .y-axis path,:host .chart.yline .y-axis path,:host .chart.xyline .y-axis path,:host .chart.xyline .x-axis path,:host .chart.yarea .y-axis path,:host .chart.yscatter .y-axis path,:host .chart.xyscatter .y-axis path,:host .chart.xyscatter .x-axis path,:host .chart.xbar .x-axis path{visibility:hidden;}:host .chart .y-label{white-space:nowrap;}:host .chart .nearbyTip{fill:var(--d3fc-series,rgba(31,119,180,0.5));}:host #dragHandles{position:absolute;top:0px;right:0px;left:auto;pointer-events:none;}:host #dragHandles rect{pointer-events:all;}:host .label rect{fill:none;}:host .legend-container{position:absolute;top:12px;right:12px;left:auto;width:150px;height:280px;}:host .legend-container.legend-color{width:90px;height:150px;}:host .legend-container[borderbox-on-hover="true"]{transition:box-shadow 1s;}:host .legend-container[borderbox-on-hover="true"]:hover{background-color:var(--d3fc-legend--background,#ffffff);transition:box-shadow 0.2s,background-color 0.2s;}:host .legend-container .legend{font-size:8pt;width:100%;}:host .legend-container .legend .cell{cursor:pointer;}:host .legend-container .legend .cell path{fill:var(--d3fc-series,rgba(31,119,180,0.5));stroke:var(--d3fc-series,rgb(31,119,180));}:host .legend-container .legend .cell.hidden path{fill:rgba(204,204,204,0.5);stroke:rgb(204,204,204);}:host .legend-container .legend .cell.hidden circle{fill:rgb(204,204,204)!important;}:host .legend-container text{fill:var(--d3fc-legend--text,rgb(51,51,51));}:host .legend-container .label:hover{fill:rgb(34,160,206);}:host .legend-container #legend-axis path{stroke:var(--d3fc-legend--text,rgb(51,51,51));}:host .legend-container .legend-controls{margin-left:12px;}:host .legend-container .legend-controls #up-arrow,:host .legend-container .legend-controls #down-arrow{cursor:pointer;color:rgb(31,119,180);}:host .legend-container .legend-controls #up-arrow.disabled,:host .legend-container .legend-controls #down-arrow.disabled{cursor:default;color:rgb(51,51,51);}:host .heatmap .legend-container.legend-color{height:200px;}:host .treemap .legend-container.legend-color{height:200px;}:host .treemap .legend-container:not(.legend-color){width:100px;}:host .zoom-controls{position:absolute;top:10px;left:0;width:100%;text-align:center;}:host .zoom-controls button{-webkit-appearance:none;background:var(--plugin--background,rgb(247,247,247));border:1px solid var(--inactive--color,rgb(204,204,204));color:var(--d3fc-label--color,inherit);font-size:12px;padding:8px;opacity:0.5;cursor:pointer;}:host .zoom-controls button:hover{opacity:1;}:host .parent-controls{position:absolute;top:30px;right:145px;width:100%;text-align:right;}:host .parent-controls button{-webkit-appearance:none;background:rgb(247,247,247);border:1px solid rgb(204,204,204);padding:10px;opacity:0.5;cursor:pointer;}:host .parent-controls button:hover{background:rgb(230,230,230);}:host div.tooltip{position:absolute;text-align:left;font-size:12px;font-weight:300;white-space:nowrap;padding:0.5em;background:var(--d3fc-tooltip--background,#ffffff);color:var(--d3fc-tooltip--color,black);border:1px solid var(--d3fc-tooltip--border-color,#777777);box-shadow:var(--d3fc-tooltip--box-shadow,none);pointer-events:none;}:host div.tooltip ul{margin:0;padding:0;list-style-type:none;}';import*as Na from"d3";var ka={initial:{type:"number",count:1,names:[]},selectMode:"select"},xi=`${La}${Si()}`,Sn=["crossValues","mainValues","realValues","splitValues","filter","data","size","colorStyles","textStyles","agg_paths","treemaps","axisMemo","columns_config"];function Si(){let e=document.querySelector("head").querySelectorAll("style"),t=[];return e.forEach(n=>{n.innerText.indexOf("d3fc-")!==-1&&t.push(n.innerText)}),t.join("")}async function bi(e){await customElements.get("perspective-viewer").registerPlugin(e)}function Ma(...e){let t=new Set(e.length>0?e:gn.map(n=>n.plugin.name));gn.forEach(n=>{if(t.has(n.plugin.name)){let r=n.plugin.name.toLowerCase().replace(/[ \t\r\n\/]*/g,""),a=`perspective-viewer-d3fc-${r}`;customElements.define(a,class extends HTMLElement{constructor(){super();this._chart=null,this._settings=null,this.render_warning=!0}connectedCallback(){this._initialized||(this.attachShadow({mode:"open"}),this.shadowRoot.innerHTML=`<style>${xi}</style>`,this.shadowRoot.innerHTML+='<div id="container" class="chart"></div>',this._container=this.shadowRoot.querySelector(".chart"),this._initialized=!0)}get name(){return n.plugin.name}get category(){return n.plugin.category}get select_mode(){return n.plugin.selectMode||"select"}get min_config_columns(){return n.plugin.initial?.count||ka.initial.count}get config_column_names(){return n.plugin.initial?.names||ka.initial.names}get max_cells(){return n.plugin.max_cells||4e3}set max_cells(i){n.plugin.max_cells=i}get max_columns(){return n.plugin.max_columns||50}set max_columns(i){n.plugin.max_columns=i}can_render_column_styles(i,l){return n.can_render_column_styles?.call(this,i,l)}column_style_controls(i,l){return n.column_style_controls?.call(this,i,l)}async render(){var i=document.createElement("canvas"),l=this.shadowRoot.querySelector("#container");i.width=l.offsetWidth,i.height=l.offsetHeight;let s=i.getContext("2d");s.fillStyle=window.getComputedStyle(this).getPropertyValue("--plugin--background")||"white",s.fillRect(0,0,i.width,i.height);let c=window.getComputedStyle(this).getPropertyValue("color"),u=Array.from(this.shadowRoot.querySelectorAll("svg:not(#dragHandles)"));for(let f of u.reverse()){var d=document.createElement("img");let h=0;d.width=f.parentElement?f.parentElement.offsetWidth:h,d.height=f.parentElement?f.parentElement.offsetHeight:h;let y=f.cloneNode(!0);y.hasAttribute("viewBox")||y.setAttribute("viewBox",`0 0 ${d.width} ${d.height}`),y.setAttribute("xmlns","http://www.w3.org/2000/svg");for(let x of y.querySelectorAll("text"))x.setAttribute("fill",c);var m=new XMLSerializer().serializeToString(y);m=m.replace(/[^\x00-\x7F]/g,"");let g=new Promise((x,b)=>{d.onload=x,d.onerror=b});try{d.src=`data:image/svg+xml;base64,${btoa(m)}`,await g}catch{let b=new Promise((S,v)=>{d.onload=S,d.onerror=v});d.src=`data:image/svg+xml;utf8,${m}`,await b}s.drawImage(d,f.parentNode.offsetLeft,f.parentNode.offsetTop,d.width,d.height)}let p=Array.from(this.shadowRoot.querySelectorAll("canvas"));for(let f of p.reverse())s.drawImage(f,f.parentNode.offsetLeft,f.parentNode.offsetTop,f.width/window.devicePixelRatio,f.height/window.devicePixelRatio);return await new Promise(f=>i.toBlob(h=>f(h)),"image/png")}async draw(i,l,s){if(this.offsetParent===null){this._staged_view=[i,l,s];return}this._staged_view=void 0,this._settings&&(this._settings.axisMemo=[[1/0,-1/0],[1/0,-1/0]]),await this.update(i,l,s,!0)}async update(i,l,s,c=!1){if(this.offsetParent===null)return;let u=this.parentElement,d,m,p=n.plugin.name!=="Sunburst";l&&s?d=i.to_columns_string({end_row:s,end_col:l,leaves_only:p}):l?d=i.to_columns_string({end_col:l,leaves_only:p}):s?d=i.to_columns_string({end_row:s,leaves_only:p}):d=i.to_columns_string({leaves_only:p}),m=await Promise.all([u.save(),u.getTable().then(_=>_.schema()),i.expression_schema(!1),i.schema(!1),d,i.get_config()]);let[f,h,y,g,x,b]=m,S=JSON.parse(x),v=Object.keys(S),V={row(_){let E={};for(let ie of v)E[ie]=S[ie][_];return E}};this.config=f;let D=this.config.columns,I=function(_){let E=h[_];return E||(E=y[_]),E},{columns:j,group_by:k,split_by:N,filter:$}=b,M=S[Object.keys(S)[0]]||[],F=k.length>0?M.reduce((_,E,ie)=>{let w=V.row(ie);if(w.__ROW_PATH__&&w.__ROW_PATH__.length==k.length)_.agg_paths.push(_.aggs.slice()),_.rows.push(w);else{let T=w.__ROW_PATH__.filter(G=>G!==void 0).length;_.aggs[T]=w,_.aggs=_.aggs.slice(0,T+1)}return _},{rows:[],aggs:[],agg_paths:[]}):{rows:M.map((_,E)=>V.row(E))},J=(_,E)=>k.length?_:{..._,__ROW_PATH__:[E]},X=F.rows.map(J),oe={realValues:D,crossValues:k.map(_=>({name:_,type:I(_)})),mainValues:j.map(_=>({name:_,type:g[_]})),splitValues:N.map(_=>({name:_,type:I(_)})),filter:$,data:X,agg_paths:F.agg_paths,...this.config.plugin_config};this._chart=n;let q={set:(_,E,ie)=>(Sn.includes(E)||this._container&&this._container.dispatchEvent(new Event("perspective-plugin-update",{bubbles:!0,composed:!0})),_[E]=ie,!0)},Q=[[1/0,-1/0],[1/0,-1/0]];this._settings=new Proxy({axisMemo:Q,...this._settings,...oe},q),this._settings.splitMainValues&&this._settings.splitMainValues.length>=j.length&&(this._settings.splitMainValues=[]),xn(this._container,this._settings),c&&(this._container.innerHTML=""),this._draw(),await new Promise(_=>requestAnimationFrame(_))}async clear(){this._container&&(this._container.innerHTML="")}_draw(){if(this.offsetParent!==null){let i=Na.select(this._container),l=`chart ${r}`;this._settings.size=this._container.getBoundingClientRect(),this._settings.data.length>0?this._chart(i.attr("class",l),this._settings):i.attr("class",`${l} disabled`)}}async resize(i){if(this.offsetParent!==null)if(this._settings?.data!==void 0)this._draw();else{let[l,s,c]=this._staged_view;this._staged_view=void 0,this.draw(l,s,c)}}async restyle(i,l,s){let c=this._settings;c&&(delete c.colorStyles,delete c.textStyles,this.isConnected&&(xn(this._container,this._settings),this.resize(i)))}async delete(){this._container.innerHTML=""}getContainer(){return this._container}save(){let i={...this._settings};return Sn.forEach(l=>{delete i[l]}),i}restore(i,l){let s={};for(let c of Sn)this._settings?.[c]!==void 0&&(s[c]=this._settings?.[c]);this._settings={...s,...i,columns_config:l}}}),customElements.whenDefined("perspective-viewer").then(()=>bi(a))}})}Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector);Ma("Candlestick");
//# sourceMappingURL=candlestick.js.map
