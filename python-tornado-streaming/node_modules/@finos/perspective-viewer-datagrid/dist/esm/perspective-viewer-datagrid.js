var Be=Object.defineProperty;var We=(t,e,r)=>e in t?Be(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var te=(t,e,r)=>(We(t,typeof e!="symbol"?e+"":e,r),r),re=(t,e,r)=>{if(!e.has(t))throw TypeError("Cannot "+r)};var P=(t,e,r)=>(re(t,e,"read from private field"),r?r.call(t):e.get(t)),oe=(t,e,r)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,r)},se=(t,e,r,s)=>(re(t,e,"write to private field"),s?s.call(t,r):e.set(t,r),r);import"regular-table";var I='regular-table{padding:0;margin:12px 0 0 12px;font-family:inherit;--rt-hover--border-color:var(--inactive--color,#c5c9d080);}regular-table div[tabindex]{outline:none;}regular-table>div{position:absolute;top:0;left:0;right:0;bottom:0;overflow:hidden;}regular-table th{text-align:center;}regular-table thead tr:not(.rt-autosize) th{overflow:hidden;max-width:0px;}regular-table thead tr:last-child .rt-float,regular-table tbody .rt-float{text-align:right;}regular-table thead .rt-integer,regular-table tbody .rt-integer{text-align:right;}regular-table tbody th{text-align:left;}regular-table span.rt-tree-container{display:flex;align-items:center;height:100%;}regular-table thead .rt-string,regular-table tbody .rt-string,regular-table thead .rt-date,regular-table tbody .rt-date,regular-table thead .rt-datetime,regular-table tbody .rt-datetime{text-align:left;}regular-table thead tr:last-child th{border-bottom:1px solid#8b868045;}regular-table tbody tr:first-child td,regular-table tbody tr:first-child th{border-top:1px solid transparent!important;}regular-table th{position:relative;}regular-table tr th span.rt-tree-group{margin-left:5px;margin-right:15px;border-left:1px solid#eee;height:100%;}regular-table td,regular-table th{white-space:nowrap;font-size:12px;padding-right:5px;padding-left:5px;padding-top:0px;padding-bottom:0px;height:19px;}regular-table table *{box-sizing:border-box;}regular-table table{position:absolute;color:#666;outline:none;}regular-table span.rt-row-header-icon{color:#aaa;padding-right:4px;font-family:var(--button--font-family);}regular-table span.rt-column-header-icon{font-size:10px;padding-left:3px;display:inline-block;width:10px;font-family:var(--button--font-family);}regular-table span.rt-row-header-icon:hover{color:#1a7da1;text-shadow:0px 0px 3px#1a7da1;}regular-table .rt-selected td{background-color:#eee;}regular-table .rt-cell-clip{overflow:hidden;text-overflow:ellipsis;}regular-table td span.rt-group-name,regular-table th span.rt-group-name{margin-right:-5px;padding-right:5px;padding-left:8px;flex:1;height:100%;}regular-table th span.rt-group-name{text-align:left;}regular-table td th span.rt-group-leaf,regular-table th span.rt-group-leaf{margin-left:16px;height:100%;}regular-table .rt-column-resize{height:100%;width:10px;position:absolute;top:0;right:0;cursor:col-resize;}regular-table a{color:var(--rt-pos-cell--color);}regular-table a:visited{color:var(--active--color);}.psp-header-border:not(.psp-is-top):not(.psp-header-leaf){box-shadow:1px 0px var(--inactive--border-color,#8b868045);}.psp-header-group{box-shadow:0px 10px 0 -9px var(--inactive--border-color,#8b868045);}.psp-is-top{box-shadow:5px 4px 0px -4px var(--inactive--border-color,#8b868045);}.psp-is-top.psp-header-group:not(.psp-header-group-corner){box-shadow:5px 4px 0px -4px var(--inactive--border-color,#8b868045),0px 10px 0 -9px var(--inactive--border-color,#8b868045);}.psp-header-border.psp-header-group:not(.psp-is-top):not(.psp-header-group-corner){box-shadow:1px 0px var(--inactive--border-color,#8b868045),0px 10px 0 -9px var(--inactive--border-color,#8b868045);}perspective-viewer[settings] tr.rt-autosize .psp-header-leaf.psp-header-border:not(.psp-menu-enabled){box-shadow:1px 0px var(--inactive--border-color,#8b868045);}:host-context(perspective-viewer[settings]) tr.rt-autosize .psp-header-leaf.psp-header-border:not(.psp-menu-enabled){box-shadow:1px 0px var(--inactive--border-color,#8b868045);}.psp-header-leaf.psp-header-border{box-shadow:5px -4px 0px -4px var(--inactive--border-color,#8b868045);}tr:only-child th{box-shadow:none!important;}regular-table tbody tr:hover th.psp-tree-leaf:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover th.psp-tree-label:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover td:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover:after{border-color:var(--rt-hover--border-color,#c5c9d080)!important;background-color:transparent;box-shadow:0px 1px 0px var(--rt-hover--border-color,#c5c9d080),0px 3px 0px rgba(0,0,0,0.05),0px 5px 0px rgba(0,0,0,0.01);}regular-table tbody tr:hover th.psp-tree-leaf.psp-menu-open:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover th.psp-tree-label.psp-menu-open:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover td.psp-menu-open:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr.psp-menu-open:hover:after{box-shadow:inset -2px 0px 0px var(--icon--color),inset 2px 0px 0px var(--icon--color),0px 1px 0px var(--rt-hover--border-color,#c5c9d080),0px 3px 0px rgba(0,0,0,0.05),0px 5px 0px rgba(0,0,0,0.01);}regular-table tbody tr:last-child:hover td.psp-menu-open:not(.psp-row-selected):not(.psp-row-subselected){box-shadow:inset -2px 0px 0px var(--icon--color),inset 2px 0px 0px var(--icon--color),inset 0px -2px 0px var(--icon--color),0px 1px 0px var(--rt-hover--border-color,#c5c9d080),0px 3px 0px rgba(0,0,0,0.05),0px 5px 0px rgba(0,0,0,0.01);}regular-table tbody tr:hover+tr th.psp-tree-leaf:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover+tr th.psp-tree-label:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover+tr td:not(.psp-row-selected):not(.psp-row-subselected){border-top-color:transparent;}regular-table tbody tr th:first-child:not(:empty),regular-table tbody tr th:first-child:empty+th:not(:empty),regular-table tbody tr th:first-child:empty~th:empty+th:not(:empty),regular-table tbody tr td:first-child{border-left-width:1px;border-left-color:transparent;}regular-table tbody tr th:last-child,regular-table tbody tr td:last-child{border-right-width:0px;border-right-color:transparent;}regular-table tbody tr:hover{color:inherit;}regular-table tbody tr:hover th:first-child:not(:empty),regular-table tbody tr:hover th:first-child:empty+th:not(:empty),regular-table tbody tr:hover th:first-child:empty~th:empty+th:not(:empty),regular-table tbody tr:hover td:first-child{border-left-color:var(--rt-hover--border-color,#c5c9d080)!important;}regular-table tbody tr:hover th:last-child,regular-table tbody tr:hover td:last-child{border-right-color:var(--rt-hover--border-color,#c5c9d080)!important;}perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table tbody td,perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table thead th:not(.rt-group-corner),:host(:not(.sub-cell-scroll-disabled)) regular-table table tbody td,:host(:not(.sub-cell-scroll-disabled)) regular-table table thead th:not(.rt-group-corner){transform:translate(var(--regular-table--transform-x,0px));}perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table tbody,:host(:not(.sub-cell-scroll-disabled)) regular-table table tbody{transform:translate(0,var(--regular-table--transform-y,0px));}perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table tbody tr:first-child td,perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table tbody tr:first-child th,:host(:not(.sub-cell-scroll-disabled)) regular-table table tbody tr:first-child td,:host(:not(.sub-cell-scroll-disabled)) regular-table table tbody tr:first-child th{clip-path:polygon(0 var(--regular-table--clip-y,0),0 200%,200% 200%,200% var(--regular-table--clip-y,0));}perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table tbody tr td:first-of-type,:host(:not(.sub-cell-scroll-disabled)) regular-table table tbody tr td:first-of-type{clip-path:polygon(var(--regular-table--clip-x,0)0,var(--regular-table--clip-x,0)200%,200% 200%,200% 0);}perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table tbody tr:first-child td:first-of-type,:host(:not(.sub-cell-scroll-disabled)) regular-table table tbody tr:first-child td:first-of-type{clip-path:polygon(var(--regular-table--clip-x,0)var(--regular-table--clip-y,0),var(--regular-table--clip-x,0)200%,200% 200%,200% var(--regular-table--clip-y,0));}perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table thead tr:last-child:after,:host(:not(.sub-cell-scroll-disabled)) regular-table table thead tr:last-child:after{transform:translate(var(--regular-table--transform-x,0px));}perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table tbody tr:not(:first-child):after,:host(:not(.sub-cell-scroll-disabled)) regular-table table tbody tr:not(:first-child):after{transform:translate(var(--regular-table--transform-x,0px));}perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table tbody tr:hover:first-child:after,:host(:not(.sub-cell-scroll-disabled)) regular-table table tbody tr:hover:first-child:after{clip-path:polygon(0 var(--regular-table--clip-y,0),0 200%,200% 200%,200% var(--regular-table--clip-y,0));}perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table thead tr th.rt-group-corner+th:not(.rt-group-corner),:host(:not(.sub-cell-scroll-disabled)) regular-table table thead tr th.rt-group-corner+th:not(.rt-group-corner){clip-path:polygon(var(--regular-table--clip-x,0)0,var(--regular-table--clip-x,0)200%,200% 200%,200% 0);}regular-table{outline:none;}regular-table::-webkit-scrollbar,regular-table::-webkit-scrollbar-corner{background-color:transparent;height:12px;width:12px;}regular-table::-webkit-scrollbar-thumb{background-clip:content-box;background:var(--icon--color);border:5.5px solid var(--plugin--background);max-height:50%;max-width:50%;min-width:10%;min-height:10%;}perspective-viewer:not([settings]) regular-table table tr.rt-autosize+tr th{height:0px;}perspective-viewer:not([settings]) regular-table table tr.rt-autosize+tr th span{display:none;}:host-context(perspective-viewer:not([settings])) regular-table table tr.rt-autosize+tr th{height:0px;}:host-context(perspective-viewer:not([settings])) regular-table table tr.rt-autosize+tr th span{display:none;}perspective-viewer[settings] .psp-menu-enabled{padding:0 6px;font-size:8px;border-radius:3px 3px 0 0;}perspective-viewer[settings] .psp-menu-enabled:hover,perspective-viewer[settings] tr:not(.rt-autosize) th.psp-menu-open{color:var(--plugin--background);background-color:var(--icon--color);border-bottom-color:var(--icon--color);cursor:pointer;}perspective-viewer[settings] tr:not(.rt-autosize) th.psp-menu-open:before{background-repeat:no-repeat;background-color:var(--icon--color);content:"";display:inline-block;-webkit-mask-size:cover;mask-size:cover;height:8px;width:10px;-webkit-mask-image:var(--column-settings-icon--mask-image);mask-image:var(--column-settings-icon--mask-image);margin-right:4px;background-color:var(--plugin--background);}perspective-viewer[settings] td.psp-menu-open{box-shadow:inset -2px 0px 0px var(--icon--color),inset 2px 0px 0px var(--icon--color);}perspective-viewer[settings] tr:first-child td.psp-menu-open{border-top-color:var(--icon--color)!important;}perspective-viewer[settings] tr:last-child td.psp-menu-open{box-shadow:inset -2px 0px 0px var(--icon--color),inset 2px 0px 0px var(--icon--color),inset 0px -2px 0px var(--icon--color);}:host-context(perspective-viewer[settings]) .psp-menu-enabled{padding:0 6px;font-size:8px;border-radius:3px 3px 0 0;}:host-context(perspective-viewer[settings]) .psp-menu-enabled:hover,:host-context(perspective-viewer[settings]) tr:not(.rt-autosize) th.psp-menu-open{color:var(--plugin--background);background-color:var(--icon--color);border-bottom-color:var(--icon--color);cursor:pointer;}:host-context(perspective-viewer[settings]) tr:not(.rt-autosize) th.psp-menu-open:before{background-repeat:no-repeat;background-color:var(--icon--color);content:"";display:inline-block;-webkit-mask-size:cover;mask-size:cover;height:8px;width:10px;-webkit-mask-image:var(--column-settings-icon--mask-image);mask-image:var(--column-settings-icon--mask-image);margin-right:4px;background-color:var(--plugin--background);}:host-context(perspective-viewer[settings]) td.psp-menu-open{box-shadow:inset -2px 0px 0px var(--icon--color),inset 2px 0px 0px var(--icon--color);}:host-context(perspective-viewer[settings]) tr:first-child td.psp-menu-open{border-top-color:var(--icon--color)!important;}:host-context(perspective-viewer[settings]) tr:last-child td.psp-menu-open{box-shadow:inset -2px 0px 0px var(--icon--color),inset 2px 0px 0px var(--icon--color),inset 0px -2px 0px var(--icon--color);}perspective-viewer regular-table table thead tr:last-child th{border-bottom-width:1px;border-bottom-color:var(--inactive--border-color,#8b868045);}:host-context(perspective-viewer) regular-table table thead tr:last-child th{border-bottom-width:1px;border-bottom-color:var(--inactive--border-color,#8b868045);}.psp-sort-enabled:hover{cursor:pointer;}.psp-row-selected,:hover .psp-row-selected,:hover th.psp-tree-leaf.psp-row-selected,:hover th.psp-tree-label.psp-row-selected{color:white!important;background-color:#ea7319!important;border-color:#ea7319!important;}.psp-row-selected.psp-tree-label:not(:hover):before{color:white;}.psp-row-subselected,:hover .psp-row-subselected,:hover th.psp-tree-leaf.psp-row-subselected,:hover th.psp-tree-label.psp-row-subselected{background:rgba(234,115,25,0.2)!important;}.psp-error{color:red;}td:focus{outline:#666;outline-style:dotted;outline-width:1px;}perspective-viewer.dragging regular-table{pointer-events:none;}:host-context(perspective-viewer.dragging) regular-table{pointer-events:none;}.psp-header-border:last-child{border-right-width:0px;}.psp-header-sort-desc:after{background-repeat:no-repeat;background-color:var(--icon--color);content:"";display:inline-block;-webkit-mask-size:cover;mask-size:cover;width:14px;height:12px;-webkit-mask-image:var(--sort-desc-icon--mask-image);mask-image:var(--sort-desc-icon--mask-image);}.psp-header-sort-asc:after{background-repeat:no-repeat;background-color:var(--icon--color);content:"";display:inline-block;-webkit-mask-size:cover;mask-size:cover;width:14px;height:12px;-webkit-mask-image:var(--sort-asc-icon--mask-image);mask-image:var(--sort-asc-icon--mask-image);}.psp-header-sort-col-desc:after{background-repeat:no-repeat;background-color:var(--icon--color);content:"";display:inline-block;-webkit-mask-size:cover;mask-size:cover;width:14px;height:12px;-webkit-mask-image:var(--sort-col-desc-icon--mask-image);mask-image:var(--sort-col-desc-icon--mask-image);}.psp-header-sort-col-asc:after{background-repeat:no-repeat;background-color:var(--icon--color);content:"";display:inline-block;-webkit-mask-size:cover;mask-size:cover;width:14px;height:12px;-webkit-mask-image:var(--sort-col-asc-icon--mask-image);mask-image:var(--sort-col-asc-icon--mask-image);}tbody th:last-of-type{border-right:1px solid var(--inactive--border-color,#8b868045);overflow:hidden;text-overflow:ellipsis;}tbody th:empty{background-image:linear-gradient(to right,transparent 9px,var(--inactive--border-color,#eee)10px,transparent 11px);background-repeat:no-repeat;min-width:20px;max-width:20px;pointer-events:none;}.psp-tree-label{max-width:0px;min-width:0px;}.psp-tree-label:before{color:var(--icon--color);font-family:var(--button--font-family,inherit);padding-right:11px;}.psp-tree-label-expand:before{content:var(--tree-label-expand--content,"+");}.psp-tree-label-collapse:before{content:var(--tree-label-collapse--content,"-");}.psp-tree-label-expand,.psp-tree-label-collapse{cursor:pointer;}.psp-tree-label:hover:before{color:var(--active--color);text-shadow:0px 0px 5px var(--active--color);}.psp-tree-leaf{padding-left:24px;}.psp-align-right{text-align:right;}.psp-align-left{text-align:left;}.psp-positive:not(:focus){color:var(--rt-pos-cell--color);}.psp-negative:not(:focus){color:var(--rt-neg-cell--color);}regular-table table tbody td{min-width:52px!important;}.psp-is-width-override .rt-column-resize,.rt-column-resize:hover{border:1px dashed#999;border-bottom-width:0px;border-left-width:0px;}.boolean-editable{cursor:pointer;}regular-table table{user-select:none;color:inherit;border-collapse:separate;}regular-table table th{font-weight:400;}regular-table table td,regular-table table th{border-color:var(--inactive--border-color,#8b868045);height:23px;}regular-table table .psp-header-group{text-overflow:ellipsis;}regular-table table th.psp-header-leaf{border-bottom-width:0px;}regular-table table th.psp-header-leaf span{height:23px;min-height:23px;}regular-table table td,regular-table table th.psp-tree-label,regular-table table th.psp-tree-label,regular-table table th.psp-tree-leaf,regular-table table tbody tr:first-child th{border-style:solid;border-width:0px;border-top-width:1px;}regular-table table tbody th:empty{background-position:0px -10px;}regular-table #psp-column-edit-buttons th:not(.rt-group-corner) span:not(.rt-column-resize):before{content:var(--datagrid-column-edit-button--content,"Edit");}perspective-viewer:not([settings]) regular-table #psp-column-edit-buttons:after{content:none;}:host-context(perspective-viewer:not([settings])) regular-table #psp-column-edit-buttons:after{content:none;}regular-table table thead tr:last-child:after{width:10000px;box-sizing:border-box;display:block;height:23px;content:"";border-bottom:1px solid var(--inactive--border-color);}regular-table table tbody tr:after{width:10000px;box-sizing:border-box;display:block;height:23px;content:"";border-top:1px solid transparent;}regular-table table tbody tr:not(:first-child):after{border-top:1px solid var(--inactive--border-color);}regular-table table tbody tr:hover:not(:first-child):after{border-top:1px solid var(--rt-hover--border-color);}regular-table table tbody tr:hover+tr:after{border-top:1px solid var(--rt-hover--border-color);}@keyframes pulse_pos{0%{background-color:var(--pulse--background-color-start,rgba(0,128,255,0.5));}100%{background-color:var(--pulse--background-color-end,rgba(0,128,255,0));}}@keyframes pulse_pos2{0%{background-color:var(--pulse--background-color-start,rgba(0,128,255,0.5));}100%{background-color:var(--pulse--background-color-end,rgba(0,128,255,0));}}@keyframes pulse_neg{0%{background-color:var(--pulse--background-color-start,rgba(255,25,0,0.5));}100%{background-color:var(--pulse--background-color-end,rgba(255,25,0,0));}}@keyframes pulse_neg2{0%{background-color:var(--pulse--background-color-start,rgba(255,25,0,0.5));}100%{background-color:var(--pulse--background-color-end,rgba(255,25,0,0));}}';function Ye(t){return t.x>=0?this._column_types[t.x]:this._row_header_types[t.row_header_x-1]}function G(t,e,r){let s=Array.from(t.children[0].children[0].children),o=s.length,l=e.hasAttribute("settings");if(o<=1?s[0]?.removeAttribute("id"):s.forEach((i,a)=>{let n=l?1:0,c=a===o-(n+1)?"psp-column-titles":a===o-n?"psp-column-edit-buttons":null;c?i.setAttribute("id",c):i.removeAttribute("id")}),e.classList.toggle("psp-menu-open",!!r),l&&o>=2){let i=Array.from(s[o-2].children),a=Array.from(s[o-1].children);if(i&&a){s.slice(0,o-2).forEach(n=>{Array.from(n.children).forEach(c=>{c.classList.toggle("psp-menu-open",!1)})});for(let n=0;n<i.length;n++){let c=i[n],d=a[n],p=c.textContent===r;if(c.classList.toggle("psp-menu-open",p),d.classList.toggle("psp-menu-open",p),this._config.columns.length>1)for(let u of t.querySelectorAll("td")){let h=t.getMeta(u),g=h.column_header[h.column_header.length-2]===r;u.classList.toggle("psp-menu-open",g)}}}}}function ie(t,e){let r=Array.from(t.children[0].children[0].children);if(r.length>0){G.call(this,t,e,this._column_settings_selected_column);let[s]=r.splice(this._config.split_by.length,1);le.call(this,t,s,!1);let[o]=r.splice(this._config.split_by.length,1);o&&le.call(this,t,o,!0)}}function le(t,e,r){let s=t._view_cache.config.row_pivots.length-1;for(let o of e?.children){let l=t.getMeta(o),i=l.column_header?.[this._config.split_by.length],a=this._config.sort.find(_=>_[0]===i),n=l.row_header_x===s,c=typeof l.x>"u";n=n||(l.x+1)%this._config.columns.length===0,o.classList.toggle("psp-header-border",n),o.classList.toggle("psp-header-group",!1),o.classList.toggle("psp-header-leaf",!0),o.classList.toggle("psp-is-top",!1),o.classList.toggle("psp-header-corner",c),o.classList.toggle("psp-header-sort-asc",!r&&!!a&&a[1]==="asc"),o.classList.toggle("psp-header-sort-desc",!r&&!!a&&a[1]==="desc"),o.classList.toggle("psp-header-sort-col-asc",!r&&!!a&&a[1]==="col asc"),o.classList.toggle("psp-header-sort-col-desc",!r&&!!a&&a[1]==="col desc");let d=Ye.call(this,l),p=d==="integer"||d==="float",u=d==="string",h=d==="date",g=d==="datetime";o.classList.toggle("psp-align-right",p),o.classList.toggle("psp-align-left",!p),o.classList.toggle("psp-menu-enabled",(u||p||h||g)&&!c&&l.column_header_y==this._config.split_by.length+1),o.classList.toggle("psp-sort-enabled",(u||p||h||g)&&!c&&l.column_header_y===this._config.split_by.length),o.classList.toggle("psp-is-width-override",t._column_sizes?.override[l.size_key]!==void 0)}}function ae(t){let e=t._view_cache.config.row_pivots.length-1,r=Array.from(t.children[0].children[0].children),s=[],o=new Set,l=t.children[0];for(let i=0;i<r.length;i++){let a=l.rows[i],n=new Set;for(let c=0;c<a.cells.length;c++){let d=a.cells[c];d.style.backgroundColor="";let p=t.getMeta(d),u=p.row_header_x===e||p.x>=0;d.classList.toggle("psp-align-right",!1),d.classList.toggle("psp-align-left",!1),d.classList.toggle("psp-header-group",!0),d.classList.toggle("psp-header-leaf",!1),d.classList.toggle("psp-header-border",u),d.classList.toggle("psp-header-group-corner",typeof p.x>"u"),d.classList.toggle("psp-color-mode-bar",!1),d.classList.toggle("psp-header-sort-asc",!1),d.classList.toggle("psp-header-sort-desc",!1),d.classList.toggle("psp-header-sort-col-asc",!1),d.classList.toggle("psp-header-sort-col-desc",!1),d.classList.toggle("psp-sort-enabled",!1);let h=a.cells[c],g=c,_,f;for(;s[i]&&s[i][g];++g);for(n.add(g),_=g;_<g+h.colSpan;++_)for(f=i;f<i+h.rowSpan;++f)s[f]||(s[f]=[]),s[f][_]=!0;h.classList.toggle("psp-is-top",i===0||!o.has(_))}o=n}}var k=Symbol("Plugin Symbol");function ne(t,e,[,,,,,r,s],[,,,,,o,l],i){let a=this._ids?.[t.dy]?.join("|"),n=(i?t.column_header.slice(0,-1):t.column_header).join("|");if(this.last_reverse_columns?.has(n)&&this.last_reverse_ids?.has(a)){let c=this.last_reverse_ids?.get(a),d=this.last_reverse_columns.get(n);this._is_old_viewport?this.last_meta?.[d]?.[c]>t.user?(e.style.setProperty("--pulse--background-color-start",o),e.style.setProperty("--pulse--background-color-end",l),e.style.animationName==="pulse_neg"?e.style.animation="pulse_neg2 0.5s linear":e.style.animation="pulse_neg 0.5s linear"):this.last_meta?.[d]?.[c]<t.user?(e.style.setProperty("--pulse--background-color-start",r),e.style.setProperty("--pulse--background-color-end",s),e.style.animationName==="pulse_pos"?e.style.animation="pulse_pos2 0.5s linear":e.style.animation="pulse_pos 0.5s linear"):c!==t.dy&&(e.style.animation=""):e.style.animation=""}else e.style.animation=""}import ce from"chroma-js";function J(t,e){return ce.mix(t,`rgb(${e[0]},${e[1]},${e[2]})`,.5).hex()}function S([t,e,r,s],o=[255,255,255]){function l(i,a){return((1-s)*(o[i]/255)+s*(a/255))*255}return[l(0,t),l(1,e),l(2,r)]}function E([t,e,r]){return Math.sqrt(t*t*.299+e*e*.587+r*r*.114)>130?"#161616":"#ffffff"}function Ue(t){let[e,r,s]=t.rgb(),[o,l,i]=t.set("hsl.h",(t.get("hsl.h")-15)%360).rgb(),[a,n,c]=t.set("hsl.h",(t.get("hsl.h")+15)%360).rgb();return`linear-gradient(to right top,rgb(${o},${l},${i}),rgb(${e},${r},${s}) 50%,rgb(${a},${n},${c}))`}function w(t){let e=ce(t),r=Ue(e),s=e.rgb();return[t,...s,r,`rgba(${s[0]},${s[1]},${s[2]},1)`,`rgba(${s[0]},${s[1]},${s[2]},0)`]}function de(t,e,r,s){let o=r.user>0,l=r.user<0,i;t?.pos_bg_color!==void 0?i=t.pos_bg_color:i=this._pos_bg_color;let a;t?.neg_bg_color!==void 0?a=t.neg_bg_color:a=this._neg_bg_color;let n=o?i:l?a:["",...this._plugin_background,""];{let[g,_,f,m,v]=n;if(e.style.position="",t?.number_bg_mode==="color")e.style.animation="",e.style.backgroundColor=g;else if(t?.number_bg_mode==="gradient"){let b=Math.max(0,Math.min(1,Math.abs(r.user/t.bg_gradient))),x=this._plugin_background,y=E(S([_,f,m,b],x));e.style.animation="",e.style.color=y,e.style.backgroundColor=`rgba(${_},${f},${m},${b})`}else t?.number_bg_mode==="pulse"?(ne.call(this,r,e,i,a,s),e.style.backgroundColor=""):(t?.number_bg_mode==="disabled"||t?.number_bg_mode,e.style.animation="",e.style.backgroundColor="")}let[c,d,p,u,h]=(()=>t?.pos_fg_color!==void 0?o?t.pos_fg_color:l?t.neg_fg_color:["",...this._plugin_background,""]:o?this._pos_fg_color:l?this._neg_fg_color:["",...this._plugin_background,""])();if(t?.number_fg_mode==="disabled")if(t?.number_bg_mode==="color"){let g=this._plugin_background,_=E(S([n[1],n[2],n[3],1],g));e.style.color=_}else t?.number_bg_mode==="gradient"||(e.style.color="");else t?.number_fg_mode==="bar"?(e.style.color="",e.style.position="relative",h!==""&&e.children.length>0&&e.children[0].nodeType===Node.ELEMENT_NODE&&(e.children[0].style.background=h)):(t?.number_fg_mode==="color"||!t?.number_fg_mode)&&(e.style.color=c)}import pe from"chroma-js";function ge(t,e,r){let s=r.column_header?.[this._config.split_by.length],[o,l,i,a,n]=(()=>t?.color!==void 0?t.color:this._color)();if(t?.string_color_mode==="foreground"&&r.user!==null)e.style.color=o,e.style.backgroundColor="",t?.format==="link"&&(e.children[0].style.color=o);else if(t?.string_color_mode==="background"&&r.user!==null){let c=this._plugin_background,d=E(S([l,i,a,1],c));e.style.color=d,e.style.backgroundColor=o}else if(t?.string_color_mode==="series"&&r.user!==null){this._series_color_map.has(s)||(this._series_color_map.set(s,new Map),this._series_color_seed.set(s,0));let c=this._series_color_map.get(s);if(!c.has(r.user)){let y=this._series_color_seed.get(s);c.set(r.user,y),this._series_color_seed.set(s,y+1)}let d=c.get(r.user),[p,u,h]=pe(o).hsl();p=p+d*150%360;let g=pe(p,u,h,"hsl"),[_,f,m]=g.rgb(),v=g.hex(),b=this._plugin_background,x=E(S([_,f,m,1],b));e.style.color=x,e.style.backgroundColor=v}else e.style.backgroundColor="",e.style.color=""}import"chroma-js";function he(t,e,r){let s=r.column_header?.[this._config.split_by.length],[o,l,i,a,n]=(()=>t?.color!==void 0?t.color:this._color)();if(t?.datetime_color_mode==="foreground"&&r.user!==null)e.style.color=o,e.style.backgroundColor="";else if(t?.datetime_color_mode==="background"&&r.user!==null){let c=this._plugin_background,d=E(S([l,i,a,1],c));e.style.color=d,e.style.backgroundColor=o}else e.style.backgroundColor="",e.style.color=""}function _e(t,e,r){let[s]=r.user===!0?this._pos_fg_color:r.user===!1?this._neg_fg_color:["",0,0,0,""];e.style.backgroundColor="",e.style.color=s}function ue(t,e,r){let s=typeof r.value!=null&&typeof r.value!=null&&r.value?.toString()?.trim().length>0,o=r.row_header_x>=this._config.group_by.length,l=t.getMeta({dx:0,dy:r.y-r.y0+1}),i=l&&l.row_header&&typeof l.row_header[r.row_header_x+1]<"u";e.classList.toggle("psp-tree-label",s&&!o),e.classList.toggle("psp-tree-label-expand",s&&!o&&!i),e.classList.toggle("psp-tree-label-collapse",s&&!o&&i),e.classList.toggle("psp-tree-leaf",s&&o)}function Ge(t){return t.x>=0?this._column_types[t.x]:this._row_header_types[t.row_header_x-1]}function be(t,e){let r=t[k]||{},s=e.hasAttribute("settings");for(let o of t.children[0].children[1].children)for(let l of o.children){let i=t.getMeta(l),a=i.column_header?.[this._config.split_by.length],n=Ge.call(this,i),c=r[a],d=n==="integer"||n==="float";d?de.call(this,c,l,i,s):n==="boolean"?_e.call(this,c,l,i):n==="string"?ge.call(this,c,l,i):n==="date"||n==="datetime"?he.call(this,c,l,i):(l.style.backgroundColor="",l.style.color=""),l.classList.toggle("psp-bool-type",n==="boolean"&&i.user!==null);let p=l.tagName==="TH";p&&ue.call(this,t,l,i),l.classList.toggle("psp-align-right",!p&&d),l.classList.toggle("psp-align-left",p||!d),l.classList.toggle("psp-color-mode-bar",c?.number_fg_mode==="bar"&&d)}}async function fe(t,e,r,s){let l=t.getMeta(s).column_header[this._config.split_by.length],a=(r.shiftKey?Je:Ve).call(this,l);this._preserve_focus_state=!0,await e.restore({sort:a})}function Je(t){let e=[],r=!1;for(let s of this._config.sort){let[o,l]=s;if(o===t){r=!0;let i=me.call(this,t,l);i&&e.push(i)}else e.push(s)}return r||e.push([t,"desc"]),e}function Ve(t){for(let[e,r]of this._config.sort)if(e===t){let s=me.call(this,t,r);return s?[s]:[]}return[[t,"desc"]]}function me(t,e){let s=this._config.split_by.length>0?Ze:Ke,o=e?s[e]:"desc";if(o)return[t,o]}var Ke={desc:"asc",asc:void 0},Ze={desc:"asc",asc:"col desc","col desc":"col asc","col asc":void 0};async function xe(t,e){let r=t.getMeta(e.target),s=e.target.classList.contains("psp-tree-label-collapse");e.shiftKey&&s?this._view.set_depth(r.row_header.filter(o=>o!==void 0).length-2):e.shiftKey?this._view.set_depth(r.row_header.filter(o=>o!==void 0).length-1):s?this._view.collapse(r.y):this._view.expand(r.y),this._num_rows=await this._view.num_rows(),this._num_columns=await this._view.num_columns(),t.draw()}async function ye(t,e,r){if(r.which!==1)return;let s=r.target;if(s.tagName!=="A"){for(;s.tagName!=="TD"&&s.tagName!=="TH";)if(s=s.parentElement,!t.contains(s))return;if(s.classList.contains("psp-tree-label")){xe.call(this,t,r),r.stopImmediatePropagation();return}if(s.classList.contains("psp-menu-enabled")){let l=t.getMeta(s).column_header?.[this._config.split_by.length];await e.toggleColumnSettings(l),r.preventDefault(),r.stopImmediatePropagation()}else s.classList.contains("psp-sort-enabled")&&(fe.call(this,t,e,r,s),r.stopImmediatePropagation())}}function ve(t,e){if(e.which!==1)return;let r=e.target;for(;r.tagName!=="TD"&&r.tagName!=="TH";)if(r=r.parentElement,!t.contains(r))return;(r.classList.contains("psp-tree-label")&&e.offsetX<26||r.classList.contains("psp-header-leaf")&&!r.classList.contains("psp-header-corner"))&&e.stopImmediatePropagation()}function we(t,e=!1){let r=this._config.group_by.length===0&&this._config.split_by.length===0,s=t.hasAttribute("selectable"),o=e||!!t.children[0]._is_edit_mode;return r&&!s&&o}function ke(t,e,r){let s=t[k]||{},o=we.call(this,e);r.classList.toggle("edit-mode-allowed",we.call(this,e,!0));for(let l of t.querySelectorAll("td")){let i=t.getMeta(l),a=this.get_psp_type(i);if(o&&this._is_editable[i.x]){let n=i.column_header[this._config.split_by.length];a==="string"&&s[n]?.format==="link"?(l.toggleAttribute("contenteditable",!1),l.classList.toggle("boolean-editable",!1)):a==="boolean"?(l.toggleAttribute("contenteditable",!1),l.classList.toggle("boolean-editable",i.user!==null)):(o!==l.hasAttribute("contenteditable")&&l.toggleAttribute("contenteditable",o),l.classList.toggle("boolean-editable",!1))}else l.toggleAttribute("contenteditable",!1),l.classList.toggle("boolean-editable",!1)}}var D=(t,e,r)=>{let s=t.querySelectorAll("td"),o=r.get(t),l=t.getRootNode();if(o){for(let i of s){let a=t.getMeta(i);if(a.x===o.x&&a.y===o.y)return l.activeElement!==i&&i.focus({preventScroll:!0}),!0}document.activeElement!==document.body&&t.contains(l.activeElement)&&l.activeElement.blur()}};function Xe(t){let e;return async function(...r){if(!!e&&await e&&!!e)return;let s;e=new Promise(o=>s=o),await t.apply(this,r),e=void 0,s()}}function Le(){if(this.isContentEditable){let t=this.getRootNode().getSelection().getRangeAt(0),e=t.cloneRange();return e.selectNodeContents(this),e.setEnd(t.endContainer,t.endOffset),e.toString().length}else return this.target.selectionStart}function V(t,e,r){let s=t.getMeta(r),o=e._schema[e._column_paths[s.x]];if(s){let l=r.textContent,i=e._ids[s.y-s.y0];if(o==="float"||o==="integer"){if(l=parseFloat(l.replace(/,/g,"")),isNaN(l))return!1}else if(o==="date"||o==="datetime"){if(l=Date.parse(l),isNaN(l))return!1}else o==="boolean"&&(l=l==="true"?!1:l==="false"?!0:null);let a={__INDEX__:i,[e._column_paths[s.x]]:l};return e._table.update([a],{port_id:e._edit_port}),!0}}function $(t,e=!1){let r=this._config.group_by.length===0&&this._config.split_by.length===0,s=t.hasAttribute("selectable"),o=e||!!t.children[0]._is_edit_mode;return r&&!s&&o}var A=Xe(async function(t,e,r,s,o){let l=t.getMeta(r),i=this._column_paths.length,a=this._num_rows,n=e.get(t);if(!n)return;l.x+s<i&&0<=l.x+s&&(n.x=l.x+s),l.y+o<a&&0<=l.y+o&&(n.y=l.y+o);let c=Math.max(l.x0-10,0),d=Math.min(l.x0+10,i),p=Math.max(l.y0-5,0),u=Math.min(l.y0+10,a),h=l.x0+s,g=l.y0+o;for(;!D(t,void 0,e)&&h>=c&&h<d&&g>=p&&g<u;)await t.scrollToCell(h,g,i,a),e.set(t,n),h+=s,g+=o});function Se(t,e,r,s){if(!$.call(this,e))return;let o=t.getRootNode().activeElement;switch(s.target.classList.remove("psp-error"),s.key){case"Enter":s.preventDefault(),s.shiftKey?A.call(this,t,r,o,0,-1):A.call(this,t,r,o,0,1);break;case"ArrowLeft":Le.call(o)==0&&(s.preventDefault(),A.call(this,t,r,o,-1,0));break;case"ArrowUp":s.preventDefault(),A.call(this,t,r,o,0,-1);break;case"ArrowRight":Le.call(o)==o.textContent.length&&(s.preventDefault(),A.call(this,t,r,o,1,0));break;case"ArrowDown":s.preventDefault(),A.call(this,t,r,o,0,1);break;default:}}function Ee(t,e,r){let s=t.getMeta(r.target);if(typeof s?.x<"u"){let o=$.call(this,e),l=this._is_editable[s.x],i=this.get_psp_type(s)==="boolean",a=r.target.textContent==="-";o&&l&&i&&!a&&V(t,this,r.target)}}function ze(t,e,r,s){if($.call(this,e)&&r.has(t)){s.target.classList.remove("psp-error");let o=r.get(t);r.delete(t),o.content!==s.target.textContent&&(V(t,this,s.target)||(s.target.textContent=o.content,s.target.classList.add("psp-error"),s.target.focus()))}}function Ae(t,e,r,s){let o=t.getMeta(s.target);if(o){let l={x:o.x,y:o.y,content:s.target.textContent};r.set(t,l)}}async function O({_view:t,_config:e},r,s){let o=e.group_by,l=e.split_by,i=r>=0?r:0,a=i+1,n=await t.to_json({start_row:i,end_row:a}),d=n.map(m=>m.__ROW_PATH__)[0]||[],p=o.map((m,v)=>{let b=d[v];return b?[m,"==",b]:void 0}).filter(m=>m),u=o.length>0?s+1:s,h=Object.keys(n[0])[u],g={row:n[0]},_=[];if(h){let m=h.split("|");g.column_names=[m[l.length]],_=l.map((v,b)=>{let x=m[b];return x?[v,"==",x]:void 0}).filter(v=>v).filter(([,,v])=>v!=="__ROW_PATH__")}let f=e.filter.concat(p).concat(_);return g.config={filter:f},g}async function Ce(t,e,r,s){let o=t.getMeta(s.target);if(!e.hasAttribute("selectable")||s.handled||s.which!==1||!o)return;let l=this._ids[o.y-o.y0];if(o&&o.y>=0){let i=r.get(t),a=!!i&&i.reduce((h,g,_)=>h&&g===l[_],!0),n=!!i&&l.length===i.length&&a,c={selected:!n},{row:d,column_names:p,config:u}=await O(this,o.y,o.x);n?(r.delete(t),c={...c,row:d,config:{filter:structuredClone(this._config.filter)}}):(r.set(t,l),c={...c,row:d,column_names:p,config:u}),await t.draw({preserve_width:!0}),s.handled=!0,e.dispatchEvent(new CustomEvent("perspective-select",{bubbles:!0,composed:!0,detail:c}))}}function Me(t,e,r){if(!e.hasAttribute("selectable"))return;let s=r.has(t),o=r.get(t);for(let l of t.querySelectorAll("td"))if(!s)l.classList.toggle("psp-row-selected",!1),l.classList.toggle("psp-row-subselected",!1);else{let i=t.getMeta(l),a=this._ids[i.y-i.y0],n=o.reduce((c,d,p)=>c&&d===a[p],!0);l.classList.toggle("psp-row-selected",a.length===o.length&&n),l.classList.toggle("psp-row-subselected",a.length!==o.length&&n)}for(let l of t.querySelectorAll("tbody th")){let i=t.getMeta(l),a=this._ids[i.y-i.y0];if(!s||!!a[i.row_header_x])l.classList.toggle("psp-row-selected",!1),l.classList.toggle("psp-row-subselected",!1);else{let n=o.reduce((c,d,p)=>c&&d===a[p],!0);l.classList.toggle("psp-row-selected",a.length===o.length&&n),l.classList.toggle("psp-row-subselected",a.length!==o.length&&n)}}}async function Oe(t,e,r){r.delete(t);for(let s of t.querySelectorAll("td,th"))s.classList.toggle("psp-row-selected",!1),s.classList.toggle("psp-row-subselected",!1)}import et from"chroma-js";import{get_type_config as T}from"@finos/perspective/src/js/config/index.js";var Re={datetime:Intl.DateTimeFormat,date:Intl.DateTimeFormat,integer:Intl.NumberFormat,float:Intl.NumberFormat,boolean:class{format(t){return t?"true":"false"}}},F=class{constructor(){this._formatters=new Map}create_datetime_formatter(e,r){let s=T(e);if(e==="datetime")if(r.date_format?.format!=="custom"){let o={...s.format,timeZone:r.date_format?.timeZone,dateStyle:r.date_format?.dateStyle,timeStyle:r.date_format?.timeStyle};return o.dateStyle==="disabled"?o.dateStyle=void 0:o.dateStyle===void 0&&(o.dateStyle=s.format.dateStyle),o.timeStyle==="disabled"?o.timeStyle=void 0:o.timeStyle===void 0&&(o.timeStyle=s.format.timeStyle),new Intl.DateTimeFormat(navigator.languages,o)}else{let o={timeZone:r.date_format?.timeZone,second:r.date_format?.second,minute:r.date_format?.minute,hour:r.date_format?.hour,day:r.date_format?.day,weekday:r.date_format?.weekday,month:r.date_format?.month,year:r.date_format?.year,hour12:r.date_format?.hour12,fractionalSecondDigits:r.date_format?.fractionalSecondDigits};return o.year==="disabled"?o.year=void 0:o.year===void 0&&(o.year="2-digit"),o.month==="disabled"?o.month=void 0:o.month===void 0&&(o.month="numeric"),o.day==="disabled"?o.day=void 0:o.day===void 0&&(o.day="numeric"),o.weekday==="disabled"&&(o.weekday=void 0),o.hour==="disabled"?o.hour=void 0:o.hour===void 0&&(o.hour="numeric"),o.minute==="disabled"?o.minute=void 0:o.minute===void 0&&(o.minute="numeric"),o.second==="disabled"?o.second=void 0:o.second===void 0&&(o.second="numeric"),o.hour12===void 0&&(o.hour12=!0),new Intl.DateTimeFormat(navigator.languages,o)}else{let o={...s.format,dateStyle:r.date_format?.dateStyle};return o.dateStyle==="disabled"?o.dateStyle=void 0:o.dateStyle===void 0&&(o.dateStyle=s.format.dateStyle),new Intl.DateTimeFormat(navigator.languages,o)}}create_number_formatter(e,r){let{format:s}=T(e);return r.number_format!==void 0&&(s=r.number_format),new Re[e](navigator.languages,s)}create_boolean_formatter(e,r){let s=T(e);return new Re[e](navigator.languages,s.format)}get(e,r){let s=[e,...Object.values(r.date_format??{}),...Object.values(r.number_format??{})].join("-");if(!this._formatters.has(s)){let o=T(e);e==="date"||e==="datetime"?this._formatters.set(s,this.create_datetime_formatter(e,r)):e==="integer"||e==="float"?this._formatters.set(s,this.create_number_formatter(e,r)):e==="boolean"?this._formatters.set(s,this.create_boolean_formatter(e,r)):this._formatters.set(s,!1)}return this._formatters.get(s)}};var Qe=new F,Ne=1;function H(t,e,r={},s=!1){if(e===null)return"-";let o=s&&this._table_schema[t]||this._schema[t]||"string",l=r[t]||{};if((o==="integer"||o==="float")&&l?.number_fg_mode==="bar"){let a=Math.max(0,Math.min(Ne,Math.abs(e/l.fg_gradient)*Ne)),n=this._div_factory.get(),c=e>=0?"left":"right",d=(a*100).toFixed(2);return n.setAttribute("style",`width:calc(${d}% - 4px);position:absolute;${c}:2px;height:80%;top:10%;pointer-events:none;`),n}else if(l?.format==="link"&&o==="string"){let a=document.createElement("a");return a.setAttribute("href",e),a.setAttribute("target","_blank"),a.textContent=e,a}else if(l?.format==="bold"&&o==="string"){let a=document.createElement("b");return a.textContent=e,a}else if(l?.format==="italics"&&o==="string"){let a=document.createElement("i");return a.textContent=e,a}else{let a=Qe.get(o,l);return a?a.format(e):e}}function*Pe(t=[],e,r){let s=r[k];for(let o of t){o=["TOTAL",...o];let l=o[o.length-1];o=o.slice(0,o.length-1).fill("");let i=H.call(this,e[o.length-1],l,s,!0);i instanceof HTMLElement?o=o.concat(i):o=o.concat({toString:()=>i}),o.length=e.length+1,yield o}}function Ie(t){let e,r,s,o,l;return async function(a,n,c,d,p){let u={},h;d-n>0&&p-c>0?(this._is_old_viewport=this._last_window?.start_row===c&&this._last_window?.end_row===p&&this._last_window?.start_col===n&&this._last_window?.end_col===d,h={start_row:c,start_col:n,end_row:p,end_col:d,id:!0},u=JSON.parse(await this._view.to_columns_string(h)),this._last_window=h,this._ids=u.__ID__,this._reverse_columns=this._column_paths.slice(n,d).reduce((b,x,y)=>(b.set(x,y),b),new Map),this._reverse_ids=this._ids.reduce((b,x,y)=>(b.set(x?.join("|"),y),b),new Map)):this._div_factory.clear();let g=[],_=[],f=[],m=[],v=t.hasAttribute("settings");for(let b=n;b<Math.min(d,this._column_paths.length);++b){let x=this._column_paths[b],y=x.split("|"),M=u[x]||new Array(p-c).fill(null);g.push(M.map(R=>H.call(this,y[this._config.split_by.length],R,a[k]))),_.push(M),v&&y.push(""),f.push(y),m.push(x)}return d-n>0&&p-c>0&&(this.last_column_paths=r,this.last_meta=e,this.last_ids=s,this.last_reverse_ids=o,this.last_reverse_columns=l,r=m,e=_,s=this._ids,o=this._reverse_ids,l=this._reverse_columns),{num_rows:this._num_rows,num_columns:this._column_paths.length,row_headers:Array.from(Pe.call(this,u.__ROW_PATH__,this._config.group_by,a)),column_headers:f,data:g,metadata:_,column_header_merge_depth:Math.max(0,this._config.split_by.length)}}}function j(t,e,r){let s=window.getComputedStyle(t).getPropertyValue(e).trim();return s.length>0?s:r}var K=class{constructor(e){this._name=e,this._elements=[],this._index=0}clear(){this._index=0}get(){this._elements[this._index]||(this._elements[this._index]=document.createElement(this._name));let e=this._elements[this._index];return this._index+=1,e}};function tt(t){return t.x>=0?this._column_types[t.x]:this._row_header_types[t.row_header_x-1]}async function Z(t,e,r,s={}){let o=await r.get_config(),l=Object.fromEntries(o.expressions.map(L=>[L[0],L[1]])),[i,a,n,c,d,p,u]=await Promise.all([e.schema(),e.validate_expressions(l),r.num_rows(),r.schema(),r.expression_schema(),r.column_paths(),this.parentElement.getEditPort()]),h=et(j(t,"--plugin--background","#FFFFFF")).rgb(),g=w(j(t,"--rt-pos-cell--color","#338DCD")),_=w(j(t,"--rt-neg-cell--color","#FF5942")),f=w(J(g[0],h)),m=w(J(_[0],h)),v=w(j(t,"--active--color","#ff0000")),b={...c,...d},x={...i,...a.expression_schema},y=p.filter(L=>L!=="__ROW_PATH__"&&L!=="__ID__"),M=[],R=[];for(let L of y){let ee=L.split("|")[o.split_by.length];R.push(b[ee]),M.push(!!i[ee])}let N=Object.assign(s,{_edit_port:u,_view:r,_table:e,_table_schema:x,_config:o,_num_rows:n,_schema:b,_ids:[],_plugin_background:h,_color:v,_pos_fg_color:g,_neg_fg_color:_,_pos_bg_color:f,_neg_bg_color:m,_column_paths:y,_column_types:R,_is_editable:M,_row_header_types:o.group_by.map(L=>x[L]),_series_color_map:new Map,_series_color_seed:new Map,get_psp_type:tt});return N._div_factory=N._div_factory||new K("div"),t.setDataListener(Ie(this.parentElement).bind(N,t),{virtual_mode:window.getComputedStyle(t).getPropertyValue("--datagrid-virtual-mode")?.trim()||"both"}),N}async function De(t,e,r){let s=t.getMeta(r.target);if(!s)return;let{x:o,y:l}=s,{row:i,column_names:a,config:n}=await O(this,l,o);e.dispatchEvent(new CustomEvent("perspective-click",{bubbles:!0,composed:!0,detail:{row:i,column_names:a,config:n}}))}async function $e(t){let e=this.parentElement,r=await e.getTable(!0);if(this._initialized)await Z.call(this,this.regular_table,r,t,this.model);else{this.innerHTML="",this.shadowRoot?this.shadowRoot.appendChild(this.regular_table):this.appendChild(this.regular_table),this.model=await Z.call(this,this.regular_table,r,t),this.regular_table.addStyleListener(be.bind(this.model,this.regular_table,e)),this.regular_table.addStyleListener(ae.bind(this.model,this.regular_table)),this.regular_table.addStyleListener(ie.bind(this.model,this.regular_table,e)),this.regular_table.addEventListener("click",ve.bind(this.model,this.regular_table)),this.regular_table.addEventListener("mousedown",ye.bind(this.model,this.regular_table,e));let s=new WeakMap;this.regular_table.addStyleListener(Me.bind(this.model,this.regular_table,e,s)),this.regular_table.addEventListener("mousedown",Ce.bind(this.model,this.regular_table,e,s)),this.regular_table.addEventListener("psp-deselect-all",Oe.bind(this.model,this.regular_table,e,s)),this.regular_table.addEventListener("click",De.bind(this.model,this.regular_table,e));let o=new WeakMap;this.regular_table.addStyleListener(ke.bind(this.model,this.regular_table,e,this)),this.regular_table.addStyleListener(D.bind(this.model,this.regular_table,e,o)),this.regular_table.addEventListener("click",Ee.bind(this.model,this.regular_table,e)),this.regular_table.addEventListener("focusin",Ae.bind(this.model,this.regular_table,e,o)),this.regular_table.addEventListener("focusout",ze.bind(this.model,this.regular_table,e,o)),this.regular_table.addEventListener("keydown",Se.bind(this.model,this.regular_table,e,o)),e.addEventListener("perspective-toggle-column-settings",l=>{if(this.isConnected){if(G.call(this.model,this.regular_table,e,l.detail.column_name),!l.detail.open){this.model._column_settings_selected_column=null;return}this.model._column_settings_selected_column=l.detail.column_name}}),this._initialized=!0}}function B(t,e=!1){if(!this._initialized)return;e&&(this._cached_column_sizes=t);let r={},{group_by:s,columns:o}=this.model._config,l=s?.length>0?s.length+1:0;for(let i of Object.keys(t))if(i==="__ROW_PATH__")r[l-1]=t[i];else{let a=this.model._column_paths.indexOf(i);r[a+l]=t[i]}this.regular_table._column_sizes.override=r}function W(){if(!this._initialized)return[];if(this._cached_column_sizes){let l=this._cached_column_sizes;return this._cached_column_sizes=void 0,l}let t=this.regular_table._column_sizes.override,{group_by:e,columns:r}=this.model._config,s=e?.length>0?e.length+1:0,o={};for(let l of Object.keys(t))if(t[l]!==void 0){let i=l-s;i>-1?o[this.model._column_paths[i]]=t[l]:i===-1&&(o.__ROW_PATH__=t[l])}return o}function q(t=void 0){typeof t>"u"&&(t=!this._is_edit_mode),this._is_edit_mode=t,this.classList.toggle("editable",t),this._edit_mode!==void 0&&this._edit_mode.classList.toggle("editable",t)}function Y(t=void 0){typeof t>"u"&&(t=!this._is_scroll_lock),this._is_scroll_lock=t,this.classList.toggle("sub-cell-scroll-disabled",t),this._scroll_lock!==void 0&&this._scroll_lock.classList.toggle("lock-scroll",t)}function Te(t,e){t=JSON.parse(JSON.stringify(t)),e=JSON.parse(JSON.stringify(e));let r={};if(t.columns)for(let[l,i]of Object.entries(t.columns))i.column_size_override!==void 0&&(r[l]=i.column_size_override,delete i.column_size_override);let s={};if(e)for(let[l,i]of Object.entries(e))s[l]={...i,pos_fg_color:i.pos_fg_color?w(i.pos_fg_color):void 0,neg_fg_color:i.neg_fg_color?w(i.neg_fg_color):void 0,pos_bg_color:i.pos_bg_color?w(i.pos_bg_color):void 0,neg_bg_color:i.neg_bg_color?w(i.neg_bg_color):void 0,color:i.color?w(i.color):void 0};"editable"in t&&q.call(this,t.editable),"scroll_lock"in t&&Y.call(this,t.scroll_lock);let o=this.regular_table;B.call(this,r,!0),o[k]=s}function Fe(){if(this.regular_table){let t={columns:{},scroll_lock:!!this._is_scroll_lock,editable:!!this._is_edit_mode},e=W.call(this);for(let r of Object.keys(e||{}))t.columns[r]||(t.columns[r]={}),t.columns[r].column_size_override=e[r];return JSON.parse(JSON.stringify(t))}return{}}async function He(t){if(this.parentElement&&await this.activate(t),!this.isConnected||this.offsetParent==null)return;let e=W.call(this),r=this.regular_table.draw({invalid_columns:!0});this.model._preserve_focus_state?this.model._preserve_focus_state=!1:(this.regular_table.scrollTop=0,this.regular_table.scrollLeft=0,this.regular_table.dispatchEvent(new CustomEvent("psp-deselect-all",{bubbles:!1})),this.regular_table._resetAutoSize()),B.call(this,e),await r,this._toolbar.classList.toggle("aggregated",this.model._config.group_by.length>0||this.model._config.split_by.length>0)}function X(t,e){return t==="integer"||t==="float"?{datagrid_number_style:{fg_gradient:0,pos_fg_color:this.model._pos_fg_color[0],neg_fg_color:this.model._neg_fg_color[0],number_fg_mode:"color",bg_gradient:0,pos_bg_color:this.model._pos_bg_color[0],neg_bg_color:this.model._neg_bg_color[0],number_bg_mode:"disabled"},number_string_format:!0}:t==="date"||t==="datetime"||t==="string"?{[t==="date"||t==="datetime"?"datagrid_datetime_style":"datagrid_string_style"]:{color:this.model._color[0],bg_color:this.model._color[0]}}:null}var z,Q=class extends HTMLElement{constructor(){super(),this.regular_table=document.createElement("regular-table"),this.regular_table.part="regular-table",this._is_scroll_lock=!1;let e=Q;e.renderTarget=="shadow"&&(P(e,z)||(se(e,z,new CSSStyleSheet),P(e,z).replaceSync(I)),this.attachShadow({mode:"open"}).adoptedStyleSheets.push(P(e,z)))}connectedCallback(){this._toolbar||(this._toolbar=document.createElement("perspective-viewer-datagrid-toolbar"));let e=this.parentElement;e&&e.appendChild(this._toolbar)}disconnectedCallback(){this._toolbar.parentElement.removeChild(this._toolbar)}async activate(e){return await $e.call(this,e)}get name(){return"Datagrid"}get category(){return"Basic"}get select_mode(){return"toggle"}get min_config_columns(){}get config_column_names(){return["Columns"]}get priority(){return 1}can_render_column_styles(e,r){return e!=="boolean"}column_style_controls(e,r){return X.call(this,e,r)}async draw(e){return await He.call(this,e)}async update(e){this.model._num_rows=await e.num_rows(),await this.regular_table.draw()}async resize(){!this.isConnected||this.offsetParent==null||this._initialized&&await this.regular_table.draw()}async clear(){this.regular_table._resetAutoSize(),this.regular_table.clear()}save(){return Fe.call(this)}restore(e,r){return Te.call(this,e,r)}async restyle(e){await this.draw(e)}delete(){this.regular_table.table_model&&this.regular_table._resetAutoSize(),this.regular_table.clear()}},C=Q;z=new WeakMap,te(C,"renderTarget",window.CSS?.supports&&window.CSS?.supports("selector(:host-context(foo))")?"shadow":"light"),oe(C,z,void 0);var je=':host{position:relative;display:block;}:host #container{position:absolute;display:flex;flex-direction:column;justify-content:stretch;align-items:stretch;top:0;left:0;right:0;bottom:0;}:host #toolbar{display:flex;align-items:center;height:36px;}:host #slot-container{flex:1;position:relative;}#scroll_lock.lock-scroll:before{-webkit-mask-image:var(--toolbar-scroll-lock-active--content);}#scroll_lock:before{-webkit-mask-image:var(--toolbar-scroll-lock--content);}#select_mode:before{content:"highlight_alt";}#edit_mode:before{-webkit-mask-image:var(--toolbar-edit-mode--content);}#edit_mode.editable:before{-webkit-mask-image:var(--toolbar-edit-mode-active--content);}#edit_mode span:before{content:var(--edit-mode-toggle--content,"Read Only");}#edit_mode.editable span:before{content:var(--edit-mode-alt-toggle--content,"Editable");}#scroll_lock span:before{content:var(--scroll-lock-toggle--content,"Free Scroll");}#scroll_lock.lock-scroll span:before{content:var(--scroll-lock-alt-toggle--content,"Align Scroll");}:host(.aggregated) #toolbar #edit_mode{display:none;}.button:before{width:25px;height:21px;content:"";-webkit-mask-image:cover;mask-image:cover;background-color:var(--icon--color,#ccc);margin:0 5px;}.button.editable:before,.button.lock-scroll:before{color:inherit;}.button{align-items:center;border-radius:3px;border:1px solid transparent;box-sizing:border-box;display:inline-flex;font-size:var(--label--font-size,0.75em);height:22px;user-select:none;white-space:nowrap;width:37px;}.button>span{display:none;margin:0;padding:0;}.button:hover{background-color:var(--icon--color);color:var(--plugin--background);opacity:1;display:flex;align-items:center;cursor:pointer;min-width:var(--button--min-width,105px);}.button:hover:before{background-color:var(--plugin--background);margin:0 5px 0 5px;}.button:hover>span{display:contents;line-height:36px;}';var U=class extends HTMLElement{connectedCallback(){if(this._initialized)return;this._initialized=!0,this.setAttribute("slot","plugin-settings"),this.attachShadow({mode:"open"}),this.shadowRoot.innerHTML=`
            <style>
                ${je}
            </style>
            <div id="toolbar">
                <span id="scroll_lock" class="button">
                    <span></span>
                </span>
                <span id="edit_mode" class="button"><span></span></span>
            </div>
        `;let e=this.parentElement,r=e.querySelector("perspective-viewer-datagrid");r._scroll_lock=this.shadowRoot.querySelector("#scroll_lock"),r._scroll_lock.addEventListener("click",()=>Y.call(r)),r._edit_mode=this.shadowRoot.querySelector("#edit_mode"),r._edit_mode.addEventListener("click",()=>{q.call(r),r.regular_table.draw(),e.dispatchEvent(new Event("perspective-config-update"))})}};function ot(){let t=document.createElement("style");t.textContent=I,document.head.insertBefore(t,document.head.firstChild)}async function st(){customElements.define("perspective-viewer-datagrid-toolbar",U),customElements.define("perspective-viewer-datagrid",C),await customElements.whenDefined("perspective-viewer"),customElements.get("perspective-viewer").registerPlugin("perspective-viewer-datagrid")}st();ot();
//# sourceMappingURL=perspective-viewer-datagrid.js.map
