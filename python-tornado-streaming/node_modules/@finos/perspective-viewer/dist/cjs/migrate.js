var g=Object.defineProperty;var k=Object.getOwnPropertyDescriptor;var x=Object.getOwnPropertyNames;var D=Object.prototype.hasOwnProperty;var S=(e,t)=>{for(var n in t)g(e,n,{get:t[n],enumerable:!0})},$=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of x(t))!D.call(e,i)&&i!==n&&g(e,i,{get:()=>t[i],enumerable:!(r=k(t,i))||r.enumerable});return e};var O=e=>$(g({},"__esModule",{value:!0}),e);var q={};S(q,{chain:()=>p,convert:()=>H});module.exports=O(q);function*Y(){for(;;)yield null}var c=class{constructor(t){if(typeof t!="string")return this.major=t.major,this.minor=t.minor,this.patch=t.patch,this.build=t.build,this;let n=/(\d+)\.(\d+)\.(\d+)(\+.+)?/,[r,i,s,o,a]=t.match(n),[m,u,f,w]=a?.match(n)??Y(),j=u&&f&&w?{major:Number(u),minor:Number(f),patch:Number(w)}:null;return this.major=Number(i),this.minor=Number(s),this.patch=Number(o),this.build=j,this}to_string(){return`${this.major}.${this.minor}.${this.patch}`}gt(t){let n=new c(t);return this.major>n.major||this.major===n.major&&this.minor>n.minor||this.major===n.major&&this.minor===n.minor&&this.patch>n.patch}eq(t){let n=new c(t);return this.major===n.major&&this.minor==n.minor&&this.patch==n.patch}ge(t){let n=new c(t);return this.eq(n)||this.gt(n)}};function l(e,t){let n=t.version_chain.shift();if(e.version?.gt(n))return e;t.warn&&console.warn(`Migrating Legacy -> ${n}`);let r=p(e,[A,E,X,N,t.replace_defaults?C:i=>i,T,L,B,V,t.omit_attributes?I:R,i=>(i.version=new c("0.0.0"),i)],t);return t.verbose&&console.log(r),r}function C(e,t){for(let n of["group_by","split_by","filter","sort"])e[n]===null&&(e[n]=[],t.warn&&console.warn(`Deprecated perspective missing attribute "${n}" set to default"`)),"aggregates"in e&&e.aggregates===null&&(e.aggregates={},t.warn&&console.warn('Deprecated perspective missing attribute "aggregates" set to default"'));return e}function _(e,t){return function(n,r){let i=0;for(let s of t)if(s in n){if(i++>0)throw new Error(`Duplicate "${e}" fields`);n[e]=n[s],s!==e&&(delete n[s],r.warn&&console.warn(`Deprecated perspective attribute "${s}" renamed "${e}"`))}return n}}var A=_("group_by",["group_by","row_pivots","row-pivot","row-pivots","row_pivot"]),E=_("split_by",["split_by","column_pivots","column-pivot","column-pivots","column_pivot","col_pivots","col-pivot","col-pivots","col_pivot"]),X=_("filter",["filter","filters"]);function P(e,t,n,r,i){if(e.test(n)){let s=n.replace(e,t);i.warn&&console.warn(`Deprecated perspective "expression" attribute value "${n}" updated to "${s}"`);for(let o of["group_by","split_by"])if(o in r)for(let a in r[o])r[o][a]===n.replace(/"/g,"")&&(r[o][a]=s,i.warn&&console.warn(`Deprecated perspective expression in "${o}" attribute "${n}" replaced with "${s}"`));for(let o of r.filter||[])o[0]===n.replace(/"/g,"")&&(o[0]=s,i.warn&&console.warn(`Deprecated perspective expression in "filter" attribute "${n}" replaced with "${s}"`));for(let o of r.sort||[])o[0]===n.replace(/"/g,"")&&(o[0]=s,i.warn&&console.warn(`Deprecated perspective expression in "sort" attribute "${n}" replaced with "${s}"`));return s}else return n}function B(e){return e.title===void 0&&(e.title=null),e}function N(e,t){if(e["computed-columns"]){if("expressions"in e)throw new Error('Duplicate "expressions" and "computed-columns');e.expressions=e["computed-columns"],delete e["computed-columns"],t.warn&&console.warn('Deprecated perspective attribute "computed-columns" renamed "expressions"');let n=[[/^year_bucket\("(.+?)"\)/,`bucket("$1", 'y')`],[/^month_bucket\("(.+?)"\)/,`bucket("$1", 'M')`],[/^day_bucket\("(.+?)"\)/,`bucket("$1", 'd')`],[/^hour_bucket\("(.+?)"\)/,`bucket("$1", 'h')`],[/^minute_bucket\("(.+?)"\)/,`bucket("$1", 'm')`],[/^second_bucket\("(.+?)"\)/,`bucket("$1", 's')`]];for(let r in e.expressions){let i=e.expressions[r];for(let[s,o]of n)i=P(s,o,i,e,t);e.expressions[r]=i}}return e}function T(e,t){let n={datagrid:"Datagrid",Datagrid:"Datagrid",d3_y_area:"Y Area","Y Area":"Y Area",d3_y_line:"Y Line","Y Line":"Y Line",d3_xy_line:"X/Y Line","X/Y Line":"X/Y Line",d3_y_scatter:"Y Scatter","Y Scatter":"Y Scatter",d3_xy_scatter:"X/Y Scatter","X/Y Scatter":"X/Y Scatter",d3_x_bar:"X Bar","X Bar":"X Bar",d3_y_bar:"Y Bar","Y Bar":"Y Bar",d3_heatmap:"Heatmap",Heatmap:"Heatmap",d3_treemap:"Treemap",Treemap:"Treemap",d3_sunburst:"Sunburst",Sunburst:"Sunburst"};return"plugin"in e&&e.plugin in n&&e.plugin!==n[e.plugin]&&(e.plugin=n[e.plugin],t.warn&&console.warn(`Deprecated perspective "plugin" attribute value "${e.plugin}" updated to "${n[e.plugin]}"`)),e}function L(e,t){return!!e.plugin_config&&e.plugin==="Datagrid"?M(e,t):e}function M(e,t){if(!e.plugin_config.columns){t.warn&&console.warn('Deprecated perspective attribute "plugin_config" moved to "plugin_config.columns"');let n={};for(let r of Object.keys(e.plugin_config)){let i=e.plugin_config[r];delete e.plugin_config[r],typeof i.color_mode=="string"&&(i.color_mode==="foreground"?i.number_fg_mode="color":i.color_mode==="bar"?i.number_fg_mode="bar":i.color_mode==="background"?i.number_bg_mode="color":i.color_mode==="gradient"?i.number_bg_mode="gradient":console.warn(`Unknown color_mode ${i.color_mode}`),delete i.color_mode,t.warn&&console.warn('Deprecated perspective attribute "color_mode" renamed "number_bg_mode"')),n[r]=i}e.plugin_config.columns=n,t.replace_defaults&&(e.plugin_config.editable=!1,e.plugin_config.scroll_lock=!0)}for(let n of Object.keys(e.plugin_config.columns)){let r=e.plugin_config.columns[n];typeof r.number_color_mode=="string"&&(r.number_color_mode==="foreground"?r.number_fg_mode="color":r.number_color_mode==="bar"?r.number_fg_mode="bar":r.number_color_mode==="background"?r.number_bg_mode="color":r.number_color_mode==="gradient"&&(r.number_bg_mode="gradient"),delete r.number_color_mode,t.warn&&console.warn('Deprecated perspective attribute "number_color_mode" renamed "number_bg_mode"')),r.gradient!==void 0&&(r.number_bg_mode==="gradient"?r.bg_gradient=r.gradient:r.number_fg_mode==="bar"&&(r.fg_gradient=r.gradient),delete r.gradient,t.warn&&console.warn('Deprecated perspective attribute "gradient" renamed "bg_gradient"')),r.pos_color!==void 0&&(r.number_bg_mode!==void 0?r.pos_bg_color=r.pos_color:r.number_fg_mode!==void 0&&(r.pos_fg_color=r.pos_color),delete r.pos_color,t.warn&&console.warn('Deprecated perspective attribute "pos_color" renamed "pos_bg_color"')),r.neg_color!==void 0&&(r.number_bg_mode!==void 0?r.neg_bg_color=r.neg_color:r.number_fg_mode!==void 0&&(r.neg_fg_color=r.neg_color),delete r.neg_color,t.warn&&console.warn('Deprecated perspective attribute "neg_color" renamed "neg_bg_color"'))}return e}function R(e,t){let n=["editable","selectable","name","table","master","linked"];for(let r of n)r in e&&(delete e[r],t.warn&&console.warn(`Deprecated perspective attribute "${r}" removed`));return e}function I(e,t){let n=["editable","selectable","name","table","master","linked"];for(let r of n)r in e&&e[r]===null&&(delete e[r],t.warn&&console.warn(`Deprecated perspective attribute "${r}" removed`));return e}function V(e,t){return"name"in e&&("title"in e&&e.title!==void 0&&(e.title=e.name,t.warn&&console.warn('"name" conflicts with "title"')),delete e.name,t.warn&&console.warn('"name" unified with "title"')),e}function b(e,t){let n=t.version_chain.shift();if(e.version?.gt(n))return e;if(t.warn&&console.warn(`Migrating 2.6.1 -> ${n}`),e.version=new c(n),e.plugin==="X/Y Scatter"&&typeof e.plugin_config?.columns=="object")for(let r in e.plugin_config.columns){let s=Object.entries(e.plugin_config.columns[r]).map(([o,a])=>{if(o==="symbols"&&Array.isArray(a)){t.warn&&console.warn(`Replacing depcrecated X/Y Scatter Plot symbol config ${a}`);let m={};for(let u in a){let f=a[u];m[f.key]=f.value}a=m}return[o,a]});e.plugin_config.columns[r]=Object.fromEntries(s)}if(Array.isArray(e.expressions)){let r={};for(let i in e.expressions)if(typeof e.expressions[i]=="string"){t.warn&&console.warn("Replacing deprecated string expression with object");let s=e.expressions[i],[o,a,m]=s.match(/\/\/\s*([^\n]+)\n(.*)/)??[s,null,null];a&&m?r[a]=m:r[o]=o}e.expressions=r}return t.verbose&&console.log(e),e}function d(e,t){let n=t.version_chain.shift();if(e.version?.gt(n))return e;t.warn&&console.warn(`Migrating 2.7.1 -> ${n}`),e.version=new c(n),e.columns_config=e.columns_config??{};let r=!!e.plugin_config?.columns,i=e.plugin==="Datagrid"||e.plugin==="X/Y Scatter";if(r&&i){t.warn&&console.warn("Migrating plugin_config to columns_config!"),e.columns_config=e.columns_config??{};let s=Object.entries(e.plugin_config.columns);for(let[o,a]of s)if(e.columns_config[o]=e.columns_config[o]??{},e.plugin==="X/Y Scatter")e.columns_config[o].symbols=e.plugin_config.columns[o]?.symbols??{},delete e.plugin_config.columns[o];else{let m=e.plugin_config.columns[o].column_width_override;delete e.plugin_config.columns[o].column_width_override;for(let[u,f]of Object.entries(a)){switch(u){case"format":if(f!=="custom")break;case"timeZone":case"fractionalSecondDigits":case"second":case"minute":case"hour":case"day":case"weekday":case"month":case"year":case"hour12":case"dateStyle":case"timeStyle":{e.columns_config[o]=e.columns_config[o]??{},e.columns_config[o].date_format=e.columns_config[o].date_format??{},e.columns_config[o].date_format[u]=f,delete e.plugin_config.columns[o][u];continue}case"fixed":{e.columns_config[o]=e.columns_config[o]??{},e.columns_config[o].number_format=e.columns_config[o].number_format??{},e.columns_config[o].number_format.minimumFractionDigits=f,e.columns_config[o].number_format.maximumFractionDigits=f,delete e.plugin_config.columns[o][u];continue}default:}e.columns_config[o]=e.columns_config[o]??{},e.columns_config[o][u]=f,delete e.plugin_config.columns[o][u]}m?e.plugin_config.columns[o]={column_width_override:m}:delete e.plugin_config.columns[o]}e.plugin==="X/Y Scatter"&&Object.keys(e.plugin_config?.columns).length===0&&delete e.plugin_config?.columns}return t.verbose&&console.log(e),e}var h={name:"@finos/perspective",version:"2.10.0",description:"Perspective.js",repository:{type:"git",url:"https://github.com/finos/perspective"},author:"",license:"Apache-2.0",unpkg:"dist/cdn/perspective.js",jsdelivr:"dist/cdn/perspective.js",exports:{".":{types:"./index.d.ts",node:"./dist/cjs/perspective.node.js",default:"./dist/esm/perspective.inline.js"},"./dist/*":"./dist/*","./src/*":"./src/*","./package.json":"./package.json"},publishConfig:{access:"public"},engines:{node:">=14"},files:["dist/**/*","src/**/*","index.d.ts"],types:"index.d.ts",scripts:{build:"node build.js",docs:"npm-run-all docs:jsdoc docs:deploy","docs:jsdoc":"jsdoc2md src/js/perspective.js -p list --separators --no-gfm > README.md","docs:deploy":`mkdir -p ../../docs/docs/obj && (echo "---
id: perspective
title: perspective API
---

"; cat README.md) > ../../docs/docs/obj/perspective.md`,"test:run":"jest --color --ci --rootDir=. --config=../../tools/perspective-test/jest.config.js",test:"npm-run-all test:run",clean:"rimraf dist"},dependencies:{stoppable:"1.1.0",ws:"^6.1.2"},devDependencies:{"@finos/perspective-cpp":"^2.10.0","@finos/perspective-esbuild-plugin":"^2.10.0",cpy:"^9.0.1",jsverify:"^0.8.4",lodash:"^4.17.4",moment:"^2.19.1","superstore-arrow":"^3.0.0"}};var v=h.version;function H(e,{warn:t=!0,verbose:n=!1,replace_defaults:r=!1}={}){if(typeof e=="object"&&!(e instanceof ArrayBuffer)){let i=JSON.parse(JSON.stringify(e)),s={warn:n?!0:t,verbose:n,replace_defaults:r};return"viewers"in i&&"detail"in i?J(i,s):y(i,!1,s)}else return e}function J(e,t){for(let n in e.viewers)e.viewers[n]=y(e.viewers[n],!0,t),"master"in e.viewers[n]||(e.viewers[n].master=!1,t.warn&&console.warn('Deprecated perspective missing attribute "master" set to default')),"linked"in e.viewers[n]||(e.viewers[n].linked=!1,t.warn&&console.warn('Deprecated perspective missing attribute "linked" set to default'));return e}function y(e,t,n){e.version=e.version?new c(e.version):new c("0.0.0"),n.omit_attributes=t,n.version_chain=["2.6.1","2.7.1","2.8.0"],n.version_chain.push(v);let r=p(e,[l,b,d,U,i=>({...i,version:i.version.to_string()})],n);return n.verbose&&console.log("Final result -> ",r),r}function U(e){if(e.version.gt(v))throw new Error("Migrated version is newer than package version!");return e.version=new c(v),e}function p(e,t,n){for(let r of t)e=r(e,n);return e}
//# sourceMappingURL=migrate.js.map
